<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ClawForge ‚Äî Build Your OpenClaw Server</title>
  <meta name="description" content="Configure an OpenClaw server like you'd spec a Mac. Pick agents, skills, personality ‚Äî preview it live in your browser." />
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23ff5c5c' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'><path d='M14.7 6.3a1 1 0 000 1.4l1.6 1.6a1 1 0 001.4 0l3.77-3.77a6 6 0 01-7.94 7.94l-6.91 6.91a2.12 2.12 0 01-3-3l6.91-6.91a6 6 0 017.94-7.94l-3.76 3.76z'/></svg>" />
  <style>
    :root {
      --black: #0a0a0a;
      --surface: #141414;
      --surface-2: #1a1a1a;
      --border: #2a2a2a;
      --border-active: #3a3a3a;
      --text: #999;
      --text-dim: #666;
      --text-bright: #e0e0e0;
      --accent: #ff5c5c;
      --accent-bg: rgba(255,92,92,0.06);
      --accent-glow: rgba(255,92,92,0.15);
      --green: #4ade80;
      --blue: #60a5fa;
      --sans: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      --mono: 'IBM Plex Mono', 'JetBrains Mono', 'Fira Code', monospace;
    }
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: var(--sans);
      background: var(--black);
      color: var(--text);
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
    }
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }

    /* ‚îÄ‚îÄ Nav ‚îÄ‚îÄ */
    .nav {
      position: sticky; top: 0; z-index: 100;
      display: flex; align-items: center; justify-content: space-between;
      padding: 16px 32px;
      background: rgba(10,10,10,0.85);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
    }
    .nav-brand {
      font-family: var(--mono);
      font-size: 0.85rem;
      font-weight: 700;
      color: var(--text-bright);
    }
    .nav-links { display: flex; gap: 20px; align-items: center; }
    .nav-links a {
      font-family: var(--mono);
      font-size: 0.75rem;
      color: var(--text);
      text-decoration: none;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }
    .nav-links a:hover { color: var(--text-bright); }

    /* ‚îÄ‚îÄ Layout ‚îÄ‚îÄ */
    .forge-layout {
      display: grid;
      grid-template-columns: 1fr 340px;
      max-width: 1200px;
      margin: 0 auto;
      gap: 0;
      min-height: calc(100vh - 60px);
    }

    /* ‚îÄ‚îÄ Main configurator ‚îÄ‚îÄ */
    .forge-main {
      padding: 48px 48px 120px;
      overflow-y: auto;
    }
    .forge-title {
      font-family: var(--sans);
      font-size: 2rem;
      font-weight: 700;
      color: var(--text-bright);
      margin-bottom: 8px;
    }
    .forge-subtitle {
      font-size: 1rem;
      color: var(--text);
      margin-bottom: 48px;
    }

    /* ‚îÄ‚îÄ Steps ‚îÄ‚îÄ */
    .step {
      margin-bottom: 56px;
    }
    .step-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
    }
    .step-num {
      font-family: var(--mono);
      font-size: 0.65rem;
      color: var(--accent);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-weight: 700;
    }
    .step-title {
      font-family: var(--sans);
      font-size: 1.15rem;
      font-weight: 600;
      color: var(--text-bright);
    }
    .step-desc {
      font-size: 0.85rem;
      color: var(--text-dim);
      margin-bottom: 16px;
      line-height: 1.6;
    }

    /* ‚îÄ‚îÄ Option cards (radio-style) ‚îÄ‚îÄ */
    .option-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 12px;
    }
    .option-card {
      background: var(--surface);
      border: 2px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      cursor: pointer;
      transition: border-color 0.2s, background 0.2s;
    }
    .option-card:hover {
      border-color: var(--border-active);
      background: var(--surface-2);
    }
    .option-card.selected {
      border-color: var(--accent);
      background: var(--accent-bg);
    }
    .option-card .option-icon {
      margin-bottom: 10px;
    }
    .option-card .option-icon svg {
      width: 28px;
      height: 28px;
      color: var(--text-dim);
      transition: color 0.2s;
    }
    .option-card.selected .option-icon svg {
      color: var(--accent);
    }
    .option-card .option-name {
      font-family: var(--sans);
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-bright);
      margin-bottom: 4px;
    }
    .option-card .option-desc {
      font-size: 0.75rem;
      color: var(--text-dim);
      line-height: 1.5;
    }

    /* ‚îÄ‚îÄ Agent builder ‚îÄ‚îÄ */
    .agent-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .agent-row {
      display: grid;
      grid-template-columns: 40px 1fr 1fr auto;
      gap: 10px;
      align-items: center;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px 16px;
    }
    .agent-row.active {
      border-color: var(--accent);
      background: var(--accent-bg);
    }
    .agent-emoji-input {
      width: 36px;
      height: 36px;
      background: var(--surface-2);
      border: 1px solid var(--border);
      border-radius: 8px;
      text-align: center;
      font-size: 1.2rem;
      color: var(--text-bright);
      outline: none;
    }
    .agent-emoji-input:focus { border-color: var(--accent); }
    .agent-text-input {
      background: var(--surface-2);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 8px 12px;
      font-family: var(--mono);
      font-size: 0.8rem;
      color: var(--text-bright);
      outline: none;
    }
    .agent-text-input:focus { border-color: var(--accent); }
    .agent-text-input::placeholder { color: var(--text-dim); }

    .btn-small {
      font-family: var(--mono);
      font-size: 0.7rem;
      padding: 6px 12px;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: var(--surface);
      color: var(--text);
      cursor: pointer;
      transition: all 0.15s;
    }
    .btn-small:hover { border-color: var(--accent); color: var(--accent); }
    .btn-small.danger:hover { border-color: #f44; color: #f44; }

    .btn-add {
      font-family: var(--mono);
      font-size: 0.75rem;
      padding: 10px 16px;
      border-radius: 8px;
      border: 2px dashed var(--border);
      background: transparent;
      color: var(--text-dim);
      cursor: pointer;
      width: 100%;
      text-align: center;
      transition: all 0.15s;
      margin-top: 8px;
    }
    .btn-add:hover { border-color: var(--accent); color: var(--accent); }

    /* ‚îÄ‚îÄ Skill toggles ‚îÄ‚îÄ */
    .skill-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 10px;
    }
    .skill-card {
      display: flex;
      align-items: center;
      gap: 12px;
      background: var(--surface);
      border: 2px solid var(--border);
      border-radius: 10px;
      padding: 14px 16px;
      cursor: pointer;
      transition: border-color 0.2s, background 0.2s;
      user-select: none;
    }
    .skill-card:hover { border-color: var(--border-active); }
    .skill-card.enabled { border-color: var(--accent); background: var(--accent-bg); }
    .skill-card .skill-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    .skill-card .skill-icon svg {
      width: 20px;
      height: 20px;
      color: var(--text-dim);
      transition: color 0.2s;
    }
    .skill-card.enabled .skill-icon svg {
      color: var(--accent);
    }
    .skill-card .skill-name {
      font-family: var(--mono);
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--text-bright);
    }
    .skill-card .skill-desc {
      font-size: 0.7rem;
      color: var(--text-dim);
    }
    .skill-toggle {
      margin-left: auto;
      width: 18px;
      height: 18px;
      border-radius: 4px;
      border: 2px solid var(--border);
      background: transparent;
      transition: all 0.15s;
      flex-shrink: 0;
    }
    .skill-card.enabled .skill-toggle {
      background: var(--accent);
      border-color: var(--accent);
    }

    /* ‚îÄ‚îÄ Textarea ‚îÄ‚îÄ */
    .forge-textarea {
      width: 100%;
      min-height: 120px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 16px;
      font-family: var(--mono);
      font-size: 0.8rem;
      color: var(--text-bright);
      outline: none;
      resize: vertical;
      line-height: 1.6;
    }
    .forge-textarea:focus { border-color: var(--accent); }
    .forge-textarea::placeholder { color: var(--text-dim); }

    /* ‚îÄ‚îÄ Model select ‚îÄ‚îÄ */
    .model-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 10px;
    }
    .model-card {
      background: var(--surface);
      border: 2px solid var(--border);
      border-radius: 10px;
      padding: 16px;
      cursor: pointer;
      transition: border-color 0.2s, background 0.2s;
    }
    .model-card:hover { border-color: var(--border-active); }
    .model-card.selected { border-color: var(--accent); background: var(--accent-bg); }
    .model-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 4px;
    }
    .model-icon {
      width: 20px;
      height: 20px;
      color: var(--text-dim);
      flex-shrink: 0;
      transition: color 0.2s;
    }
    .model-card.selected .model-icon {
      color: var(--accent);
    }
    .model-name {
      font-family: var(--mono);
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--text-bright);
    }
    .model-provider {
      font-size: 0.7rem;
      color: var(--text-dim);
    }
    .model-badge {
      display: inline-block;
      font-family: var(--mono);
      font-size: 0.6rem;
      padding: 2px 8px;
      border-radius: 4px;
      background: var(--green);
      color: #000;
      font-weight: 700;
      margin-top: 6px;
    }

    /* ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ */
    .forge-sidebar {
      position: sticky;
      top: 60px;
      height: calc(100vh - 60px);
      border-left: 1px solid var(--border);
      background: var(--surface);
      padding: 32px 24px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }
    .sidebar-title {
      font-family: var(--mono);
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-dim);
      margin-bottom: 16px;
    }
    .sidebar-server-name {
      font-family: var(--sans);
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--text-bright);
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .sidebar-section {
      margin-bottom: 20px;
    }
    .sidebar-label {
      font-family: var(--mono);
      font-size: 0.65rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--text-dim);
      margin-bottom: 6px;
    }
    .sidebar-value {
      font-size: 0.85rem;
      color: var(--text-bright);
    }
    .sidebar-list {
      list-style: none;
    }
    .sidebar-list li {
      font-size: 0.8rem;
      color: var(--text);
      padding: 3px 0;
    }
    .sidebar-actions {
      margin-top: auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding-top: 24px;
      border-top: 1px solid var(--border);
    }
    .btn-forge {
      font-family: var(--mono);
      font-size: 0.8rem;
      font-weight: 700;
      padding: 14px 20px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      text-align: center;
      transition: all 0.15s;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }
    .btn-preview {
      background: var(--accent);
      color: #000;
    }
    .btn-preview:hover { background: #ff7070; }
    .btn-deploy {
      background: var(--surface-2);
      color: var(--text-bright);
      border: 1px solid var(--border);
    }
    .btn-deploy:hover { border-color: var(--accent); color: var(--accent); }
    .btn-save {
      background: transparent;
      color: var(--text);
      border: 1px solid var(--border);
    }
    .btn-save:hover { border-color: var(--text-dim); color: var(--text-bright); }

    /* ‚îÄ‚îÄ Workspace files ‚îÄ‚îÄ */
    .file-tabs {
      display: flex;
      gap: 0;
      border-bottom: 1px solid var(--border);
      margin-bottom: 0;
      overflow-x: auto;
    }
    .file-tab {
      font-family: var(--mono);
      font-size: 0.72rem;
      padding: 10px 16px;
      color: var(--text-dim);
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all 0.15s;
      white-space: nowrap;
      background: none;
      border-top: none;
      border-left: none;
      border-right: none;
    }
    .file-tab:hover { color: var(--text-bright); }
    .file-tab.active {
      color: var(--accent);
      border-bottom-color: var(--accent);
    }

    /* ‚îÄ‚îÄ Template picker ‚îÄ‚îÄ */
    .template-bar {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
      padding: 12px 16px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
    }
    .template-bar label {
      font-family: var(--mono);
      font-size: 0.7rem;
      color: var(--text-dim);
      text-transform: uppercase;
      letter-spacing: 0.06em;
      white-space: nowrap;
    }
    .template-select {
      flex: 1;
      background: var(--surface-2);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 8px 12px;
      font-family: var(--mono);
      font-size: 0.8rem;
      color: var(--text-bright);
      outline: none;
    }
    .template-select:focus { border-color: var(--accent); }

    /* ‚îÄ‚îÄ Server name input ‚îÄ‚îÄ */
    .server-name-row {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-bottom: 32px;
    }
    .server-name-row input {
      flex: 1;
    }

    /* ‚îÄ‚îÄ Modal ‚îÄ‚îÄ */
    .modal-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(4px);
      z-index: 200;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .modal {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      max-width: 600px;
      width: 100%;
      padding: 32px;
      max-height: 90vh;
      overflow-y: auto;
    }
    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    .modal-title {
      font-family: var(--sans);
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--text-bright);
    }
    .modal-close {
      background: none;
      border: none;
      color: var(--text-dim);
      font-size: 1.5rem;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 6px;
      transition: color 0.15s;
    }
    .modal-close:hover { color: var(--text-bright); }
    .modal-desc {
      font-size: 0.85rem;
      color: var(--text-dim);
      margin-bottom: 24px;
    }

    .deploy-grid {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .deploy-option {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px;
      background: var(--black);
      border: 1px solid var(--border);
      border-radius: 10px;
      cursor: pointer;
      transition: border-color 0.2s, background 0.2s;
    }
    .deploy-option:hover {
      border-color: var(--accent);
      background: var(--accent-bg);
    }
    .deploy-option.deploy-provider {
      opacity: 0.6;
      cursor: default;
    }
    .deploy-option.deploy-provider:hover {
      border-color: var(--border);
      background: var(--black);
    }
    .deploy-icon {
      flex-shrink: 0;
    }
    .deploy-icon svg {
      width: 24px;
      height: 24px;
      color: var(--text-dim);
    }
    .deploy-option:hover .deploy-icon svg {
      color: var(--accent);
    }
    .deploy-option.deploy-provider:hover .deploy-icon svg {
      color: var(--text-dim);
    }
    .deploy-info { flex: 1; }
    .deploy-name {
      font-family: var(--mono);
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--text-bright);
      margin-bottom: 2px;
    }
    .deploy-desc {
      font-size: 0.72rem;
      color: var(--text-dim);
    }
    .deploy-badge {
      font-family: var(--mono);
      font-size: 0.6rem;
      padding: 2px 8px;
      border-radius: 4px;
      background: var(--surface-2);
      border: 1px solid var(--border);
      color: var(--text-dim);
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }
    .deploy-divider {
      font-family: var(--mono);
      font-size: 0.65rem;
      color: var(--text-dim);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      padding: 12px 0 4px;
      border-top: 1px solid var(--border);
      margin-top: 8px;
    }

    .command-label {
      font-family: var(--mono);
      font-size: 0.7rem;
      color: var(--text-dim);
      margin: 16px 0 8px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }
    .command-box {
      display: flex;
      align-items: center;
      background: var(--black);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 12px 16px;
      gap: 12px;
    }
    .command-box code {
      flex: 1;
      font-family: var(--mono);
      font-size: 0.78rem;
      color: var(--accent);
      word-break: break-all;
      user-select: all;
    }
    .command-copy {
      background: none;
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 6px 8px;
      cursor: pointer;
      color: var(--text-dim);
      transition: all 0.15s;
      flex-shrink: 0;
    }
    .command-copy:hover { border-color: var(--accent); color: var(--accent); }

    /* ‚îÄ‚îÄ Responsive ‚îÄ‚îÄ */
    @media (max-width: 900px) {
      .forge-layout {
        grid-template-columns: 1fr;
      }
      .forge-sidebar {
        position: relative;
        top: 0;
        height: auto;
        border-left: none;
        border-top: 1px solid var(--border);
      }
      .forge-main {
        padding: 32px 20px 60px;
      }
    }
    @media (max-width: 600px) {
      .option-grid { grid-template-columns: 1fr; }
      .skill-grid { grid-template-columns: 1fr; }
      .model-grid { grid-template-columns: 1fr; }
      .agent-row { grid-template-columns: 36px 1fr auto; }
      .agent-row > :nth-child(2) { grid-column: 2 / 4; }
      .agent-row > :nth-child(3) { grid-column: 2 / 4; }
    }
  </style>
</head>
<body>

  <!-- Nav -->
  <nav class="nav">
    <a href="/" class="nav-brand"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="width:16px;height:16px;display:inline;vertical-align:-2px;margin-right:6px;"><path d="M14.7 6.3a1 1 0 000 1.4l1.6 1.6a1 1 0 001.4 0l3.77-3.77a6 6 0 01-7.94 7.94l-6.91 6.91a2.12 2.12 0 01-3-3l6.91-6.91a6 6 0 017.94-7.94l-3.76 3.76z"/></svg>ClawForge</a>
    <div class="nav-links">
      <a href="/library.html"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="width:12px;height:12px;display:inline;vertical-align:-1px;margin-right:4px;"><path d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 002 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0022 16z"/></svg>My Servers</a>
      <a href="/chat.html"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="width:12px;height:12px;display:inline;vertical-align:-1px;margin-right:4px;"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>Chat</a>
      <a href="/">‚Üê VibeClaw</a>
      <span id="auth-container" style="margin-left:8px;"></span>
    </div>
  </nav>

  <!-- Layout -->
  <div class="forge-layout">
    <!-- Main configurator -->
    <div class="forge-main">
      <h1 class="forge-title">Build your server</h1>
      <p class="forge-subtitle">Configure your OpenClaw server. Preview it live. Deploy it anywhere.</p>

      <!-- Template picker -->
      <div class="template-bar">
        <label>Start from</label>
        <select id="template-select" class="template-select">
          <option value="">Blank server</option>
        </select>
      </div>

      <!-- Server name -->
      <div class="server-name-row">
        <input id="server-emoji" class="agent-emoji-input" type="text" value="ü¶Ä" maxlength="4" />
        <input id="server-name" class="agent-text-input" type="text" placeholder="My Server" value="My Server" style="flex:1;font-size:1.1rem;padding:12px 16px;" />
      </div>

      <!-- Step 1: Runtime -->
      <div class="step">
        <div class="step-header">
          <span class="step-num">01</span>
          <span class="step-title">Runtime</span>
        </div>
        <p class="step-desc">Choose your server's core mode.</p>
        <div class="option-grid" id="runtime-options">
          <div class="option-card selected" data-value="single">
            <div class="option-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg></div>
            <div class="option-name">Standard</div>
            <div class="option-desc">Single agent, clean and fast</div>
          </div>
          <div class="option-card" data-value="multi">
            <div class="option-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="7" r="3"/><circle cx="17" cy="7" r="3"/><path d="M3 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/><path d="M17 14a4 4 0 014 4v2"/></svg></div>
            <div class="option-name">Multi-Agent</div>
            <div class="option-desc">Agent squads with team routing</div>
          </div>
          <div class="option-card" data-value="minimal">
            <div class="option-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg></div>
            <div class="option-name">Minimal</div>
            <div class="option-desc">Lightweight, low-resource mode</div>
          </div>
        </div>
      </div>

      <!-- Step 2: Agents -->
      <div class="step">
        <div class="step-header">
          <span class="step-num">02</span>
          <span class="step-title">Agents</span>
        </div>
        <p class="step-desc">Add agents to your server. The first agent is the lead.</p>
        <div class="agent-list" id="agent-list">
          <div class="agent-row active" data-idx="0">
            <input type="text" class="agent-emoji-input" value="ü¶Ä" maxlength="4" data-field="emoji" />
            <input type="text" class="agent-text-input" placeholder="Agent name" value="Claw" data-field="name" />
            <input type="text" class="agent-text-input" placeholder="Role / description" value="General-purpose coding assistant" data-field="desc" />
            <span style="font-size:0.65rem;color:var(--text-dim);font-family:var(--mono);">LEAD</span>
          </div>
        </div>
        <button class="btn-add" id="add-agent-btn">+ Add Agent</button>
      </div>

      <!-- Step 3: Skills -->
      <div class="step">
        <div class="step-header">
          <span class="step-num">03</span>
          <span class="step-title">Skills</span>
        </div>
        <p class="step-desc">Toggle the skills your server should have.</p>
        <div class="skill-grid" id="skill-grid">
          <div class="skill-card enabled" data-skill="chat">
            <span class="skill-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg></span>
            <div>
              <div class="skill-name">Chat</div>
              <div class="skill-desc">Conversational AI via LLM</div>
            </div>
            <div class="skill-toggle"></div>
          </div>
          <div class="skill-card enabled" data-skill="filesystem">
            <span class="skill-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg></span>
            <div>
              <div class="skill-name">Filesystem</div>
              <div class="skill-desc">Read, write, and manage files</div>
            </div>
            <div class="skill-toggle"></div>
          </div>
          <div class="skill-card enabled" data-skill="execute">
            <span class="skill-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 17 10 11 4 5"/><line x1="12" y1="19" x2="20" y2="19"/></svg></span>
            <div>
              <div class="skill-name">Execute</div>
              <div class="skill-desc">Run shell commands</div>
            </div>
            <div class="skill-toggle"></div>
          </div>
          <div class="skill-card" data-skill="web-browse">
            <span class="skill-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"/></svg></span>
            <div>
              <div class="skill-name">Web Browse</div>
              <div class="skill-desc">Search and fetch web pages</div>
            </div>
            <div class="skill-toggle"></div>
          </div>
          <div class="skill-card" data-skill="github">
            <span class="skill-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0020 4.77 5.07 5.07 0 0019.91 1S18.73.65 16 2.48a13.38 13.38 0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 005 4.77a5.44 5.44 0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 009 18.13V22"/></svg></span>
            <div>
              <div class="skill-name">GitHub</div>
              <div class="skill-desc">PRs, issues, repos, CI</div>
            </div>
            <div class="skill-toggle"></div>
          </div>
          <div class="skill-card" data-skill="docker">
            <span class="skill-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="6" width="20" height="12" rx="2"/><path d="M6 6V4a2 2 0 012-2h8a2 2 0 012 2v2"/><line x1="10" y1="11" x2="10" y2="13"/><line x1="14" y1="11" x2="14" y2="13"/></svg></span>
            <div>
              <div class="skill-name">Docker</div>
              <div class="skill-desc">Container build & deploy</div>
            </div>
            <div class="skill-toggle"></div>
          </div>
          <div class="skill-card" data-skill="image-gen">
            <span class="skill-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg></span>
            <div>
              <div class="skill-name">Image Gen</div>
              <div class="skill-desc">Generate and edit images</div>
            </div>
            <div class="skill-toggle"></div>
          </div>
          <div class="skill-card" data-skill="scheduling">
            <span class="skill-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg></span>
            <div>
              <div class="skill-name">Scheduling</div>
              <div class="skill-desc">Cron jobs and reminders</div>
            </div>
            <div class="skill-toggle"></div>
          </div>
          <div class="skill-card" data-skill="browser-auto">
            <span class="skill-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M8 12l3 3 5-5"/></svg></span>
            <div>
              <div class="skill-name">Browser Auto</div>
              <div class="skill-desc">Navigate, click, fill, screenshot</div>
            </div>
            <div class="skill-toggle"></div>
          </div>
          <div class="skill-card" data-skill="security">
            <span class="skill-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg></span>
            <div>
              <div class="skill-name">Security</div>
              <div class="skill-desc">Vuln scan, threat modeling</div>
            </div>
            <div class="skill-toggle"></div>
          </div>
          <div class="skill-card" data-skill="email">
            <span class="skill-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22 6 12 13 2 6"/></svg></span>
            <div>
              <div class="skill-name">Email</div>
              <div class="skill-desc">Read and send emails</div>
            </div>
            <div class="skill-toggle"></div>
          </div>
          <div class="skill-card" data-skill="calendar">
            <span class="skill-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg></span>
            <div>
              <div class="skill-name">Calendar</div>
              <div class="skill-desc">Events and scheduling</div>
            </div>
            <div class="skill-toggle"></div>
          </div>
        </div>
      </div>

      <!-- Step 4: Personality -->
      <div class="step">
        <div class="step-header">
          <span class="step-num">04</span>
          <span class="step-title">Personality</span>
        </div>
        <p class="step-desc">Define how your agent behaves. This becomes the system prompt.</p>
        <textarea id="system-prompt" class="forge-textarea" placeholder="You are a helpful coding assistant. Be concise, direct, and pragmatic...">You are ü¶Ä Claw, a helpful coding assistant. Be concise, direct, and pragmatic. Show code, not just descriptions. Always explain the 'why' behind your suggestions.</textarea>
      </div>

      <!-- Step 5: Workspace Files -->
      <div class="step">
        <div class="step-header">
          <span class="step-num">05</span>
          <span class="step-title">Workspace Files</span>
        </div>
        <p class="step-desc">Set up the markdown files that define your agent's memory, identity, and tools.</p>
        <div class="file-tabs" id="file-tabs">
          <button class="file-tab active" data-file="AGENTS.md">AGENTS.md</button>
          <button class="file-tab" data-file="SOUL.md">SOUL.md</button>
          <button class="file-tab" data-file="USER.md">USER.md</button>
          <button class="file-tab" data-file="TOOLS.md">TOOLS.md</button>
        </div>
        <textarea id="file-editor" class="forge-textarea" style="border-top-left-radius:0;border-top-right-radius:0;min-height:160px;">## My Agent

This is your agent's workspace configuration. Define how it operates, what it remembers, and how it interacts.

## Memory

Update this file as you learn about the workspace and user preferences.</textarea>
      </div>

      <!-- Step 6: Model -->
      <div class="step">
        <div class="step-header">
          <span class="step-num">06</span>
          <span class="step-title">Model</span>
        </div>
        <p class="step-desc">Choose the LLM that powers your server.</p>
        <div class="model-grid" id="model-grid">
          <div class="model-card selected" data-model="deepseek/deepseek-chat-v3-0324:free">
            <div class="model-header">
              <svg class="model-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="3"/><path d="M12 1v4m0 14v4M4.22 4.22l2.83 2.83m9.9 9.9l2.83 2.83M1 12h4m14 0h4M4.22 19.78l2.83-2.83m9.9-9.9l2.83-2.83"/></svg>
              <div class="model-name">DeepSeek V3</div>
            </div>
            <div class="model-provider">DeepSeek</div>
            <span class="model-badge">FREE</span>
          </div>
          <div class="model-card" data-model="qwen/qwen3-8b:free">
            <div class="model-header">
              <svg class="model-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
              <div class="model-name">Qwen3 8B</div>
            </div>
            <div class="model-provider">Alibaba</div>
            <span class="model-badge">FREE</span>
          </div>
          <div class="model-card" data-model="microsoft/phi-4-reasoning:free">
            <div class="model-header">
              <svg class="model-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="8" height="8"/><rect x="13" y="3" width="8" height="8"/><rect x="3" y="13" width="8" height="8"/><rect x="13" y="13" width="8" height="8"/></svg>
              <div class="model-name">Phi-4 Reasoning</div>
            </div>
            <div class="model-provider">Microsoft</div>
            <span class="model-badge">FREE</span>
          </div>
          <div class="model-card" data-model="google/gemma-3-4b-it:free">
            <div class="model-header">
              <svg class="model-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 3l1.5 4.5H18l-3.5 2.5L16 15l-4-3-4 3 1.5-5L6 7.5h4.5z"/></svg>
              <div class="model-name">Gemma 3 4B</div>
            </div>
            <div class="model-provider">Google</div>
            <span class="model-badge">FREE</span>
          </div>
          <div class="model-card" data-model="mistralai/mistral-small-3.1-24b-instruct:free">
            <div class="model-header">
              <svg class="model-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 2v4m0 12v4M6 8l-3-2m18 2l-3-2M6 16l-3 2m18-2l-3 2"/><circle cx="12" cy="12" r="4"/></svg>
              <div class="model-name">Mistral Small 3.1</div>
            </div>
            <div class="model-provider">Mistral AI</div>
            <span class="model-badge">FREE</span>
          </div>
          <div class="model-card" data-model="anthropic/claude-sonnet-4">
            <div class="model-header">
              <svg class="model-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"/><path d="M8 12l3 3 5-5"/></svg>
              <div class="model-name">Claude Sonnet 4</div>
            </div>
            <div class="model-provider">Anthropic</div>
          </div>
          <div class="model-card" data-model="google/gemini-2.5-pro-preview">
            <div class="model-header">
              <svg class="model-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 3l1.5 4.5H18l-3.5 2.5L16 15l-4-3-4 3 1.5-5L6 7.5h4.5z"/></svg>
              <div class="model-name">Gemini 2.5 Pro</div>
            </div>
            <div class="model-provider">Google</div>
          </div>
          <div class="model-card" data-model="openai/gpt-4o">
            <div class="model-header">
              <svg class="model-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
              <div class="model-name">GPT-4o</div>
            </div>
            <div class="model-provider">OpenAI</div>
          </div>
        </div>
      </div>

    </div>

    <!-- Sidebar -->
    <div class="forge-sidebar">
      <div class="sidebar-title">Your Server</div>
      <div class="sidebar-server-name" id="sidebar-name">
        <span id="sidebar-emoji"><svg viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="width:20px;height:20px;"><rect x="3" y="3" width="18" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg></span>
        <span id="sidebar-name-text">My Server</span>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-label">Runtime</div>
        <div class="sidebar-value" id="sidebar-runtime">Standard</div>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-label">Agents</div>
        <ul class="sidebar-list" id="sidebar-agents">
          <li>Claw</li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-label">Skills</div>
        <ul class="sidebar-list" id="sidebar-skills">
          <li>Chat</li>
          <li>Filesystem</li>
          <li>Execute</li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-label">Model</div>
        <div class="sidebar-value" id="sidebar-model">DeepSeek V3</div>
      </div>

      <div class="sidebar-actions">
        <button class="btn-forge btn-preview" id="preview-btn"><svg viewBox="0 0 24 24" fill="currentColor" style="width:12px;height:12px;display:inline;vertical-align:-1px;margin-right:6px;"><polygon points="5 3 19 12 5 21 5 3"/></svg>Preview</button>
        <button class="btn-forge btn-deploy" id="deploy-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="width:14px;height:14px;display:inline;vertical-align:-2px;margin-right:6px;"><path d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 002 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0022 16z"/></svg>Deploy</button>
        <button class="btn-forge btn-save" id="save-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="width:14px;height:14px;display:inline;vertical-align:-2px;margin-right:6px;"><path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>Save to Library</button>
      </div>
    </div>
  </div>

  <!-- Deploy Modal -->
  <div id="deploy-modal" class="modal-overlay" style="display:none;">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">Deploy your server</h2>
        <button class="modal-close" id="deploy-close">&times;</button>
      </div>
      <p class="modal-desc">Your server spec is ready. Choose how you want to deploy it.</p>

      <div class="deploy-grid">
        <!-- Download -->
        <div class="deploy-option" id="deploy-download">
          <div class="deploy-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg></div>
          <div class="deploy-info">
            <div class="deploy-name">Download Package</div>
            <div class="deploy-desc">openclaw.json config, workspace files, setup script, and README</div>
          </div>
        </div>

        <!-- JSON Spec -->
        <div class="deploy-option" id="deploy-json">
          <div class="deploy-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg></div>
          <div class="deploy-info">
            <div class="deploy-name">Server Spec (JSON)</div>
            <div class="deploy-desc">Download the raw server specification file</div>
          </div>
        </div>

        <!-- Quick install -->
        <div class="deploy-option" id="deploy-docker">
          <div class="deploy-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 17 10 11 4 5"/><line x1="12" y1="19" x2="20" y2="19"/></svg></div>
          <div class="deploy-info">
            <div class="deploy-name">Quick Install</div>
            <div class="deploy-desc">One-line install script ‚Äî installs OpenClaw and starts the gateway</div>
          </div>
        </div>

        <!-- npm -->
        <div class="deploy-option" id="deploy-cli">
          <div class="deploy-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 002 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0022 16z"/></svg></div>
          <div class="deploy-info">
            <div class="deploy-name">npm</div>
            <div class="deploy-desc">Install via npm and run the setup wizard</div>
          </div>
        </div>

        <!-- One-click providers -->
        <div class="deploy-divider">One-click deploy</div>

        <div class="deploy-option deploy-provider" id="deploy-railway">
          <div class="deploy-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="4" y="2" width="16" height="20" rx="2"/><line x1="4" y1="7" x2="20" y2="7"/><line x1="4" y1="12" x2="20" y2="12"/><line x1="4" y1="17" x2="20" y2="17"/></svg></div>
          <div class="deploy-info">
            <div class="deploy-name">Railway</div>
            <div class="deploy-desc">Deploy to Railway with one click</div>
          </div>
          <span class="deploy-badge">soon</span>
        </div>

        <div class="deploy-option deploy-provider" id="deploy-flyio">
          <div class="deploy-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 2L11 13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg></div>
          <div class="deploy-info">
            <div class="deploy-name">Fly.io</div>
            <div class="deploy-desc">Deploy to Fly.io globally</div>
          </div>
          <span class="deploy-badge">soon</span>
        </div>

        <div class="deploy-option deploy-provider" id="deploy-render">
          <div class="deploy-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg></div>
          <div class="deploy-info">
            <div class="deploy-name">Render</div>
            <div class="deploy-desc">Deploy as a Render web service</div>
          </div>
          <span class="deploy-badge">soon</span>
        </div>
      </div>

      <!-- Command preview area -->
      <div id="deploy-command-area" style="display:none;">
        <div class="command-label" id="deploy-command-label"></div>
        <div class="command-box">
          <code id="deploy-command-text"></code>
          <button class="command-copy" id="deploy-copy-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="width:14px;height:14px;"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ‚îÄ‚îÄ State ‚îÄ‚îÄ
    const state = {
      emoji: 'ü¶Ä',
      name: 'My Server',
      runtime: 'single',
      agents: [
        { emoji: 'ü¶Ä', name: 'Claw', desc: 'General-purpose coding assistant' }
      ],
      skills: new Set(['chat', 'filesystem', 'execute']),
      systemPrompt: '',
      files: {
        'AGENTS.md': '## My Agent\n\nThis is your agent\'s workspace configuration. Define how it operates, what it remembers, and how it interacts.\n\n## Memory\n\nUpdate this file as you learn about the workspace and user preferences.',
        'SOUL.md': '# Soul\n\nBe helpful, concise, and direct. Have opinions. Show code, not just words.',
        'USER.md': '# About the User\n\nAdd notes about the user\'s preferences, timezone, and workflow here.',
        'TOOLS.md': '# Tools\n\nNote down tool-specific config: camera names, SSH hosts, API endpoints, etc.'
      },
      activeFile: 'AGENTS.md',
      model: 'deepseek/deepseek-chat-v3-0324:free',
    };

    let allFlavours = [];

    // ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ
    const $ = id => document.getElementById(id);
    const $$ = sel => document.querySelectorAll(sel);

    function updateSidebar() {
      // Show user emoji if set, otherwise show server icon
      const emojiEl = $('sidebar-emoji');
      if (state.emoji && state.emoji.trim()) {
        emojiEl.textContent = state.emoji;
        emojiEl.style.fontSize = '1.3rem';
      }
      $('sidebar-name-text').textContent = state.name;

      const runtimeNames = { single: 'Standard', multi: 'Multi-Agent', minimal: 'Minimal' };
      $('sidebar-runtime').textContent = runtimeNames[state.runtime] || state.runtime;

      const agentIcon = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:12px;height:12px;vertical-align:-1px;margin-right:4px;"><circle cx="12" cy="7" r="4"/><path d="M5.5 21a6.5 6.5 0 0113 0"/></svg>';
      $('sidebar-agents').innerHTML = state.agents
        .map(a => `<li>${agentIcon}${escHtml(a.name || 'Unnamed')}</li>`).join('');

      const skillIcons = {
        'chat': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:12px;height:12px;vertical-align:-1px;margin-right:4px;"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>',
        'filesystem': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:12px;height:12px;vertical-align:-1px;margin-right:4px;"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg>',
        'execute': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:12px;height:12px;vertical-align:-1px;margin-right:4px;"><polyline points="4 17 10 11 4 5"/><line x1="12" y1="19" x2="20" y2="19"/></svg>',
        'web-browse': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:12px;height:12px;vertical-align:-1px;margin-right:4px;"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/></svg>',
        'github': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:12px;height:12px;vertical-align:-1px;margin-right:4px;"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0020 4.77 5.07 5.07 0 0019.91 1S18.73.65 16 2.48a13.38 13.38 0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 005 4.77a5.44 5.44 0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 009 18.13V22"/></svg>',
        'docker': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:12px;height:12px;vertical-align:-1px;margin-right:4px;"><rect x="2" y="6" width="20" height="12" rx="2"/></svg>',
        'image-gen': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:12px;height:12px;vertical-align:-1px;margin-right:4px;"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>',
        'scheduling': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:12px;height:12px;vertical-align:-1px;margin-right:4px;"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>',
        'browser-auto': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:12px;height:12px;vertical-align:-1px;margin-right:4px;"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M8 12l3 3 5-5"/></svg>',
        'security': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:12px;height:12px;vertical-align:-1px;margin-right:4px;"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>',
        'email': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:12px;height:12px;vertical-align:-1px;margin-right:4px;"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22 6 12 13 2 6"/></svg>',
        'calendar': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:12px;height:12px;vertical-align:-1px;margin-right:4px;"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>',
      };
      const skillLabels = {
        'chat': 'Chat', 'filesystem': 'Filesystem', 'execute': 'Execute',
        'web-browse': 'Web Browse', 'github': 'GitHub', 'docker': 'Docker',
        'image-gen': 'Image Gen', 'scheduling': 'Scheduling', 'browser-auto': 'Browser Auto',
        'security': 'Security', 'email': 'Email', 'calendar': 'Calendar',
      };
      $('sidebar-skills').innerHTML = [...state.skills]
        .map(s => `<li>${skillIcons[s] || ''}${skillLabels[s] || s}</li>`).join('');

      const modelEl = document.querySelector('.model-card.selected');
      $('sidebar-model').textContent = modelEl
        ? modelEl.querySelector('.model-name').textContent
        : state.model.split('/').pop();
    }

    // ‚îÄ‚îÄ Server name ‚îÄ‚îÄ
    $('server-emoji').addEventListener('input', e => {
      state.emoji = e.target.value || 'ü¶Ä';
      updateSidebar();
    });
    $('server-name').addEventListener('input', e => {
      state.name = e.target.value || 'My Server';
      updateSidebar();
    });

    // ‚îÄ‚îÄ Runtime ‚îÄ‚îÄ
    $$('#runtime-options .option-card').forEach(card => {
      card.addEventListener('click', () => {
        $$('#runtime-options .option-card').forEach(c => c.classList.remove('selected'));
        card.classList.add('selected');
        state.runtime = card.dataset.value;
        updateSidebar();
      });
    });

    // ‚îÄ‚îÄ Agents ‚îÄ‚îÄ
    function renderAgents() {
      const list = $('agent-list');
      list.innerHTML = state.agents.map((a, i) => `
        <div class="agent-row ${i === 0 ? 'active' : ''}" data-idx="${i}">
          <input type="text" class="agent-emoji-input" value="${a.emoji}" maxlength="4" data-field="emoji" />
          <input type="text" class="agent-text-input" placeholder="Agent name" value="${escHtml(a.name)}" data-field="name" />
          <input type="text" class="agent-text-input" placeholder="Role / description" value="${escHtml(a.desc)}" data-field="desc" />
          ${i === 0
            ? '<span style="font-size:0.65rem;color:var(--text-dim);font-family:var(--mono);">LEAD</span>'
            : '<button class="btn-small danger" data-remove="' + i + '">‚úï</button>'
          }
        </div>
      `).join('');

      // Bind inputs
      list.querySelectorAll('.agent-row').forEach(row => {
        const idx = parseInt(row.dataset.idx);
        row.querySelectorAll('input').forEach(inp => {
          inp.addEventListener('input', () => {
            state.agents[idx][inp.dataset.field] = inp.value;
            updateSidebar();
          });
        });
        const rmBtn = row.querySelector('[data-remove]');
        if (rmBtn) rmBtn.addEventListener('click', () => {
          state.agents.splice(idx, 1);
          renderAgents();
          updateSidebar();
        });
      });
    }

    function escHtml(s) {
      return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
    }

    $('add-agent-btn').addEventListener('click', () => {
      const emojis = ['ü§ñ','üîç','‚úçÔ∏è','üé®','üõ°Ô∏è','üì°','‚öôÔ∏è','üß™','üìä','üéØ'];
      state.agents.push({
        emoji: emojis[state.agents.length % emojis.length],
        name: '',
        desc: ''
      });
      renderAgents();
      updateSidebar();
    });

    // ‚îÄ‚îÄ Skills ‚îÄ‚îÄ
    $$('.skill-card').forEach(card => {
      card.addEventListener('click', () => {
        const skill = card.dataset.skill;
        if (state.skills.has(skill)) {
          state.skills.delete(skill);
          card.classList.remove('enabled');
        } else {
          state.skills.add(skill);
          card.classList.add('enabled');
        }
        updateSidebar();
      });
    });

    // ‚îÄ‚îÄ System prompt ‚îÄ‚îÄ
    $('system-prompt').addEventListener('input', e => {
      state.systemPrompt = e.target.value;
    });

    // ‚îÄ‚îÄ File editor ‚îÄ‚îÄ
    const fileTabs = $$('#file-tabs .file-tab');
    fileTabs.forEach(tab => {
      tab.addEventListener('click', () => {
        // Save current
        state.files[state.activeFile] = $('file-editor').value;
        // Switch
        fileTabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        state.activeFile = tab.dataset.file;
        $('file-editor').value = state.files[state.activeFile] || '';
      });
    });

    // ‚îÄ‚îÄ Model ‚îÄ‚îÄ
    $$('.model-card').forEach(card => {
      card.addEventListener('click', () => {
        $$('.model-card').forEach(c => c.classList.remove('selected'));
        card.classList.add('selected');
        state.model = card.dataset.model;
        updateSidebar();
      });
    });

    // ‚îÄ‚îÄ Load flavours as templates ‚îÄ‚îÄ
    async function loadFlavours() {
      try {
        const resp = await fetch('/flavours.json');
        allFlavours = await resp.json();
        const sel = $('template-select');
        allFlavours.forEach(f => {
          const opt = document.createElement('option');
          opt.value = f.id;
          opt.textContent = `${f.emoji} ${f.name} ‚Äî ${f.description}`;
          sel.appendChild(opt);
        });
      } catch {}
    }

    $('template-select').addEventListener('change', () => {
      const id = $('template-select').value;
      if (!id) {
        // Reset to blank
        state.emoji = 'ü¶Ä';
        state.name = 'My Server';
        state.runtime = 'single';
        state.agents = [{ emoji: 'ü¶Ä', name: 'Claw', desc: 'General-purpose coding assistant' }];
        state.skills = new Set(['chat', 'filesystem', 'execute']);
        state.model = 'deepseek/deepseek-chat-v3-0324:free';
        $('system-prompt').value = 'You are ü¶Ä Claw, a helpful coding assistant. Be concise, direct, and pragmatic.';
        state.systemPrompt = $('system-prompt').value;
      } else {
        const fl = allFlavours.find(f => f.id === id);
        if (!fl) return;
        state.emoji = fl.emoji;
        state.name = fl.name;
        state.runtime = (fl.teams && fl.teams.length > 0) ? 'multi' : 'single';
        state.agents = fl.agents.map(a => ({ emoji: a.emoji, name: a.name, desc: a.description }));
        state.skills = new Set((fl.skills || []).map(s => s.name));
        // Also enable the built-in skills
        ['chat', 'filesystem', 'execute'].forEach(s => state.skills.add(s));
        state.systemPrompt = fl.systemPrompt || '';
        $('system-prompt').value = state.systemPrompt;
      }

      // Update UI
      $('server-emoji').value = state.emoji;
      $('server-name').value = state.name;
      $$('#runtime-options .option-card').forEach(c => {
        c.classList.toggle('selected', c.dataset.value === state.runtime);
      });
      renderAgents();
      $$('.skill-card').forEach(card => {
        card.classList.toggle('enabled', state.skills.has(card.dataset.skill));
      });
      updateSidebar();
    });

    // ‚îÄ‚îÄ Build spec ‚îÄ‚îÄ
    function buildSpec() {
      state.files[state.activeFile] = $('file-editor').value;
      state.systemPrompt = $('system-prompt').value;
      return {
        specVersion: '1.0',
        id: 'srv_' + Math.random().toString(36).slice(2, 10),
        name: state.name,
        emoji: state.emoji,
        runtime: { type: state.runtime, model: { provider: 'openrouter', model: state.model } },
        agents: state.agents.map((a, i) => ({
          id: i === 0 ? 'main' : a.name.toLowerCase().replace(/[^a-z0-9]/g, '') || 'agent' + i,
          name: a.name,
          emoji: a.emoji,
          role: i === 0 ? 'lead' : 'specialist',
          description: a.desc,
          ...(i === 0 ? { systemPrompt: state.systemPrompt } : {})
        })),
        skills: [...state.skills].map(s => ({ source: 'builtin:' + s })),
        workspace: { ...state.files },
      };
    }

    // ‚îÄ‚îÄ Preview ‚îÄ‚îÄ
    $('preview-btn').addEventListener('click', () => {
      const spec = buildSpec();
      // Save spec to sessionStorage and redirect to main page with preview mode
      sessionStorage.setItem('forge-preview-spec', JSON.stringify(spec));
      window.location.href = '/?preview=forge';
    });

    // ‚îÄ‚îÄ Save to library ‚îÄ‚îÄ
    $('save-btn').addEventListener('click', () => {
      const spec = buildSpec();
      // Save to localStorage
      let library = [];
      try { library = JSON.parse(localStorage.getItem('clawforge-library') || '[]'); } catch {}
      // Check if already saved (update)
      const existing = library.findIndex(s => s.name === spec.name);
      if (existing >= 0) {
        spec.id = library[existing].id;
        library[existing] = spec;
      } else {
        library.push(spec);
      }
      localStorage.setItem('clawforge-library', JSON.stringify(library));
      if (confirm(`Saved "${spec.emoji} ${spec.name}" to your library!\n\nView your servers?`)) {
        window.location.href = '/library.html';
      }
    });

    // ‚îÄ‚îÄ Deploy modal ‚îÄ‚îÄ
    const deployModal = $('deploy-modal');
    const deployCommandArea = $('deploy-command-area');
    const deployCommandLabel = $('deploy-command-label');
    const deployCommandText = $('deploy-command-text');
    let deploySpec = null;

    function showDeployModal() {
      deploySpec = buildSpec();
      deployModal.style.display = '';
      deployCommandArea.style.display = 'none';
    }

    function hideDeployModal() {
      deployModal.style.display = 'none';
    }

    function showCommand(label, cmd) {
      deployCommandLabel.textContent = label;
      deployCommandText.textContent = cmd;
      deployCommandArea.style.display = '';
    }

    function downloadBlob(content, filename, type) {
      const blob = new Blob([content], { type });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      a.click();
      URL.revokeObjectURL(url);
    }

    function specToSlug(spec) {
      return (spec.name || 'server').toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-|-$/g, '');
    }

    function generateOpenClawConfig(spec) {
      const model = spec.runtime?.model?.model || 'anthropic/claude-sonnet-4';
      // Map OpenRouter model IDs to OpenClaw provider/model format
      const provider = model.includes('/') ? model.split('/')[0] : 'anthropic';
      const modelId = model.includes('/') ? model : `anthropic/${model}`;

      const config = {
        agents: {
          defaults: {
            model: { primary: modelId },
            workspace: './workspace',
          },
        },
        sessions: {
          defaults: {
            model: modelId,
          },
        },
      };
      return JSON.stringify(config, null, 2);
    }

    function generateSetupScript(spec) {
      const slug = specToSlug(spec);
      return `#!/bin/bash
# ${spec.name} ‚Äî Setup Script
# Generated by ClawForge (vibeclaw.dev)
set -e

echo "Setting up ${spec.name}..."

# Install OpenClaw if not present
if ! command -v openclaw &> /dev/null; then
  echo "Installing OpenClaw..."
  curl -fsSL https://openclaw.ai/install.sh | bash -s -- --no-onboard
fi

# Create workspace directory
mkdir -p workspace

# Copy config
cp openclaw.json ~/.openclaw/openclaw.json

# Copy workspace files
for f in workspace/*; do
  [ -f "$f" ] && cp "$f" ~/.openclaw/workspace/
done

echo ""
echo "Done! Run: openclaw gateway start"
echo ""
`;
    }

    function generateReadme(spec) {
      const agentList = (spec.agents || []).map(a => `- **${a.name}** ‚Äî ${a.description || a.role || ''}`).join('\n');
      const skillList = (spec.skills || []).map(s => `- ${(s.source || s.name || '').replace('builtin:', '')}`).join('\n');
      return `# ${spec.name}

> Generated by [ClawForge](https://vibeclaw.dev/forge)

## Agents

${agentList}

## Skills

${skillList}

## Setup

\`\`\`bash
# Option 1: Run the setup script
chmod +x setup.sh && ./setup.sh

# Option 2: Manual
curl -fsSL https://openclaw.ai/install.sh | bash
cp openclaw.json ~/.openclaw/openclaw.json
cp workspace/* ~/.openclaw/workspace/
openclaw gateway start
\`\`\`
`;
    }

    $('deploy-btn').addEventListener('click', showDeployModal);
    $('deploy-close').addEventListener('click', hideDeployModal);
    deployModal.addEventListener('click', (e) => {
      if (e.target === deployModal) hideDeployModal();
    });

    // Download package ‚Äî real openclaw.json + workspace files + setup script
    $('deploy-download').addEventListener('click', () => {
      if (!deploySpec) return;
      const slug = specToSlug(deploySpec);

      // Build all files
      const files = {
        'openclaw.json': generateOpenClawConfig(deploySpec),
        'setup.sh': generateSetupScript(deploySpec),
        'README.md': generateReadme(deploySpec),
      };
      // Add workspace files
      const ws = deploySpec.workspace || {};
      for (const [name, content] of Object.entries(ws)) {
        if (content) files[`workspace/${name}`] = content;
      }
      // Add server spec for reference
      files['server-spec.json'] = JSON.stringify(deploySpec, null, 2);

      // Download as a single JSON manifest (with clear file paths)
      // Users can extract with a simple script, or we can add zip later
      const pkg = { _generator: 'ClawForge v1.0', _url: 'https://vibeclaw.dev', files };
      downloadBlob(JSON.stringify(pkg, null, 2), `${slug}.clawforge.json`, 'application/json');
      hideDeployModal();
    });

    // Raw JSON spec
    $('deploy-json').addEventListener('click', () => {
      if (!deploySpec) return;
      downloadBlob(JSON.stringify(deploySpec, null, 2), `${specToSlug(deploySpec)}-spec.json`, 'application/json');
      hideDeployModal();
    });

    // Docker command ‚Äî not available yet, show install instructions instead
    $('deploy-docker').addEventListener('click', () => {
      if (!deploySpec) return;
      showCommand('Install & Run', `curl -fsSL https://openclaw.ai/install.sh | bash && openclaw gateway start`);
    });

    // CLI command ‚Äî real openclaw install
    $('deploy-cli').addEventListener('click', () => {
      if (!deploySpec) return;
      showCommand('Install OpenClaw', `npm install -g openclaw && openclaw onboard`);
    });

    // Copy command
    $('deploy-copy-btn').addEventListener('click', () => {
      const text = deployCommandText.textContent;
      navigator.clipboard.writeText(text).then(() => {
        $('deploy-copy-btn').innerHTML = '‚úì';
        setTimeout(() => {
          $('deploy-copy-btn').innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="width:14px;height:14px;"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>';
        }, 1500);
      });
    });

    // ‚îÄ‚îÄ Init ‚îÄ‚îÄ
    state.systemPrompt = $('system-prompt').value;

    // Check if loaded with a template ID or library index
    const params = new URLSearchParams(location.search);
    if (params.has('template')) {
      loadFlavours().then(() => {
        $('template-select').value = params.get('template');
        $('template-select').dispatchEvent(new Event('change'));
      });
    } else if (params.has('load')) {
      // Load from library
      try {
        const library = JSON.parse(localStorage.getItem('clawforge-library') || '[]');
        const idx = parseInt(params.get('load'));
        const srv = library[idx];
        if (srv) {
          state.emoji = srv.emoji || 'ü¶Ä';
          state.name = srv.name || 'My Server';
          state.runtime = srv.runtime?.type || 'single';
          state.agents = (srv.agents || []).map(a => ({
            emoji: a.emoji || 'ü§ñ',
            name: a.name || '',
            desc: a.description || a.role || ''
          }));
          state.skills = new Set((srv.skills || []).map(s =>
            s.source ? s.source.replace('builtin:', '') : s.name || ''
          ).filter(Boolean));
          state.systemPrompt = (srv.agents && srv.agents[0] && srv.agents[0].systemPrompt) || '';
          if (srv.workspace) {
            Object.assign(state.files, srv.workspace);
          }
          state.model = srv.runtime?.model?.model || state.model;

          // Update all UI
          $('server-emoji').value = state.emoji;
          $('server-name').value = state.name;
          $('system-prompt').value = state.systemPrompt;
          $('file-editor').value = state.files[state.activeFile] || '';
          $$('#runtime-options .option-card').forEach(c => {
            c.classList.toggle('selected', c.dataset.value === state.runtime);
          });
          $$('.skill-card').forEach(card => {
            card.classList.toggle('enabled', state.skills.has(card.dataset.skill));
          });
          $$('.model-card').forEach(c => {
            c.classList.toggle('selected', c.dataset.model === state.model);
          });
          renderAgents();
          updateSidebar();
        }
      } catch (e) { console.warn('Load from library error:', e); }
    } else {
      loadFlavours();
    }
  </script>

  <script src="/auth.js"></script>
  <script>
    VibeclawAuth.init().then(() => {
      VibeclawAuth.renderButton('auth-container');
    });
  </script>

</body>
</html>
