[dev]
  port = 9888
  targetPort = 5174
  framework = "#custom"
  command = "npx vite --port 5174"

[build]
  command = "npm run flavours:build && npm run build"
  publish = "dist-site"
  functions = "netlify/functions"

[build.environment]
  NODE_VERSION = "22"

[[redirects]]
  from = "/api/chat"
  to = "/.netlify/functions/chat"
  status = 200

[[redirects]]
  from = "/api/relay"
  to = "/.netlify/functions/relay"
  status = 200

[[redirects]]
  from = "/forge"
  to = "/forge.html"
  status = 200

[[redirects]]
  from = "/library"
  to = "/library.html"
  status = 200

[[redirects]]
  from = "/chat"
  to = "/chat.html"
  status = 200

[[redirects]]
  from = "/api/subscription/webhook"
  to = "/.netlify/functions/subscription"
  status = 200

[[redirects]]
  from = "/api/subscription"
  to = "/.netlify/functions/subscription"
  status = 200

[[redirects]]
  from = "/api/*"
  to = "/.netlify/functions/api/:splat"
  status = 200

[[headers]]
  for = "/*"
  [headers.values]
    Cross-Origin-Embedder-Policy = "credentialless"
    Cross-Origin-Opener-Policy = "same-origin"
