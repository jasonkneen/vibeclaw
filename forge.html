<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" href="/favicon.ico" sizes="32x32">
  <link rel="icon" href="/favicon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VibeClaw Forge â€” Build Your OpenClaw Server | vibeclaw</title>
  <meta name="description" content="Visual server builder for OpenClaw. Configure agents, skills, and personality â€” then preview it live in your browser. Export, deploy, or download your custom AI agent server." />
  <meta name="keywords" content="openclaw, server builder, ai agent, configuration, no-code, visual builder, vibeclaw">
  <meta name="author" content="vibeclaw">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://vibeclaw.dev/forge.html">

  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://vibeclaw.dev/forge.html">
  <meta property="og:title" content="VibeClaw Forge â€” Build Your OpenClaw Server">
  <meta property="og:description" content="Visual server builder for OpenClaw. Configure agents, skills, and personality â€” preview live in your browser.">
  <meta property="og:image" content="https://vibeclaw.dev/og-image.png">
  <meta property="og:site_name" content="vibeclaw.dev">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@vibeclaw">
  <meta name="twitter:creator" content="@jasonkneen">
  <meta name="twitter:title" content="VibeClaw Forge â€” Build Your OpenClaw Server">
  <meta name="twitter:description" content="Visual server builder for OpenClaw. Configure, preview, and deploy custom AI agent servers.">
  <meta name="twitter:image" content="https://vibeclaw.dev/og-image.png">

  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23ff5c5c' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'><path d='M14.7 6.3a1 1 0 000 1.4l1.6 1.6a1 1 0 001.4 0l3.77-3.77a6 6 0 01-7.94 7.94l-6.91 6.91a2.12 2.12 0 01-3-3l6.91-6.91a6 6 0 017.94-7.94l-3.76 3.76z'/></svg>" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fragment+Mono:wght@400;500;600;700&family=DM+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600;700&display=swap&font-display=swap" rel="stylesheet">
  <style>
    :root {
      --black: #0a0a0a;
      --surface: #141414;
      --surface-2: #1a1a1a;
      --border: #2a2a2a;
      --border-active: #3a3a3a;
      --text: #999;
      --text-dim: #666;
      --text-bright: #e0e0e0;
      --accent: #ff5c5c;
      --accent-bg: rgba(255,92,92,0.06);
      --accent-glow: rgba(255,92,92,0.15);
      --green: #4ade80;
      --blue: #60a5fa;
      --sans: 'DM Sans', system-ui, sans-serif; --code: 'JetBrains Mono', 'SF Mono', 'Menlo', monospace;
      --mono: 'Fragment Mono', 'JetBrains Mono', 'Menlo', monospace;
    }
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: var(--sans);
      background: var(--black);
      color: var(--text);
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
    }
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }

    /* â”€â”€ Nav â”€â”€ */
    .nav {
      position: sticky; top: 0; z-index: 100;
      display: flex; align-items: center; justify-content: space-between;
      padding: 16px 32px;
      background: rgba(10,10,10,0.85);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
    }
    .nav-brand {
      font-family: var(--mono);
      font-size: 0.85rem;
      font-weight: 700;
      color: var(--text-bright);
    }
    .nav-links { display: flex; gap: 20px; align-items: center; }
    .nav-links a {
      font-family: var(--mono);
      font-size: 0.75rem;
      color: var(--text);
      text-decoration: none;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }
    .nav-links a:hover { color: var(--text-bright); }
    @media (max-width: 600px) {
      .nav { padding: 10px 12px; }
      .nav-brand img { height: 28px !important; }
      .nav-links { gap: 10px; }
      .nav-links a { font-size: 0.6rem; }
      #auth-container, #upgrade-container { margin-left: 2px !important; }
      .auth-login-btn { padding: 3px 6px !important; font-size: 0.55rem !important; }
      .auth-login-btn svg { width: 9px !important; height: 9px !important; }
      .auth-user { gap: 4px !important; }
      .auth-avatar { width: 18px !important; height: 18px !important; }
      .auth-name { max-width: 50px !important; font-size: 0.55rem !important; }
      .auth-logout-btn { padding: 2px 4px !important; font-size: 0.5rem !important; }
    }

    @media (max-width: 380px) {
      .auth-text { display: none; }
      .auth-login-btn { padding: 3px 5px !important; }
      .auth-name { display: none; }
      .auth-logout-btn { font-size: 0.45rem !important; padding: 2px 3px !important; }
    }

    /* â”€â”€ Layout â”€â”€ */
    .forge-layout {
      display: grid;
      grid-template-columns: 1fr 340px;
      max-width: 1400px;
      margin: 0 auto;
      gap: 0;
      min-height: calc(100vh - 60px);
    }

    /* â”€â”€ Main configurator â”€â”€ */
    .forge-main {
      padding: 48px 48px 120px;
      overflow-y: auto;
    }
    .forge-title {
      font-family: var(--sans);
      font-size: 2rem;
      font-weight: 700;
      color: var(--text-bright);
      margin-bottom: 8px;
    }
    .forge-subtitle {
      font-size: 1rem;
      color: var(--text);
      margin-bottom: 48px;
    }

    /* â”€â”€ Steps â”€â”€ */
    .step {
      margin-bottom: 56px;
    }
    .step-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
    }
    .step-num {
      font-family: var(--mono);
      font-size: 0.65rem;
      color: var(--accent);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-weight: 700;
    }
    .step-title {
      font-family: var(--sans);
      font-size: 1.15rem;
      font-weight: 600;
      color: var(--text-bright);
    }
    .step-desc {
      font-size: 0.85rem;
      color: var(--text-dim);
      margin-bottom: 16px;
      line-height: 1.6;
    }

    /* â”€â”€ Option cards (radio-style) â”€â”€ */
    .option-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 12px;
    }
    .option-card {
      background: var(--surface);
      border: 2px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      cursor: pointer;
      transition: border-color 0.2s, background 0.2s;
    }
    .option-card:hover {
      border-color: var(--border-active);
      background: var(--surface-2);
    }
    .option-card.selected {
      border-color: var(--accent);
      background: var(--accent-bg);
    }
    .option-card .option-icon {
      margin-bottom: 10px;
    }
    .option-card .option-icon svg {
      width: 28px;
      height: 28px;
      color: var(--text-dim);
      transition: color 0.2s;
    }
    .option-card.selected .option-icon svg {
      color: var(--accent);
    }
    .option-card .option-name {
      font-family: var(--sans);
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-bright);
      margin-bottom: 4px;
    }
    .option-card .option-desc {
      font-size: 0.75rem;
      color: var(--text-dim);
      line-height: 1.5;
    }

    /* â”€â”€ Agent builder â”€â”€ */
    .agent-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .agent-row {
      display: grid;
      grid-template-columns: 40px 1fr 1fr auto;
      gap: 10px;
      align-items: center;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px 16px;
    }
    .agent-row.active {
      border-color: var(--accent);
      background: var(--accent-bg);
    }
    .agent-emoji-input {
      width: 36px;
      height: 36px;
      background: var(--surface-2);
      border: 1px solid var(--border);
      border-radius: 8px;
      text-align: center;
      font-size: 1.2rem;
      color: var(--text-bright);
      outline: none;
    }
    .agent-emoji-input:focus { border-color: var(--accent); }
    .agent-text-input {
      background: var(--surface-2);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 8px 12px;
      font-family: var(--mono);
      font-size: 0.8rem;
      color: var(--text-bright);
      outline: none;
    }
    .agent-text-input:focus { border-color: var(--accent); }
    .agent-text-input::placeholder { color: var(--text-dim); }

    .btn-small {
      font-family: var(--mono);
      font-size: 0.7rem;
      padding: 8px 14px;
      min-height: 44px;
      min-width: 44px;
      border-radius: 6px;
      border: 1px solid var(--border);
      background: var(--surface);
      color: var(--text);
      cursor: pointer;
      transition: all 0.15s;
    }
    .btn-small:hover { border-color: var(--accent); color: var(--accent); }
    .btn-small.danger:hover { border-color: #f44; color: #f44; }

    .btn-add {
      font-family: var(--mono);
      font-size: 0.75rem;
      padding: 10px 16px;
      border-radius: 8px;
      border: 2px dashed var(--border);
      background: transparent;
      color: var(--text-dim);
      cursor: pointer;
      width: 100%;
      text-align: center;
      transition: all 0.15s;
      margin-top: 8px;
    }
    .btn-add:hover { border-color: var(--accent); color: var(--accent); }

    /* â”€â”€ Skill toggles â”€â”€ */
    .skill-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 10px;
    }
    .skill-card {
      display: flex;
      align-items: center;
      gap: 12px;
      background: var(--surface);
      border: 2px solid var(--border);
      border-radius: 10px;
      padding: 14px 16px;
      cursor: pointer;
      transition: border-color 0.2s, background 0.2s;
      user-select: none;
    }
    .skill-card:hover { border-color: var(--border-active); }
    .skill-card.enabled { border-color: var(--accent); background: var(--accent-bg); }
    .skill-card .skill-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    .skill-card .skill-icon svg {
      width: 20px;
      height: 20px;
      color: var(--text-dim);
      transition: color 0.2s;
    }
    .skill-card.enabled .skill-icon svg {
      color: var(--accent);
    }
    .skill-card .skill-name {
      font-family: var(--mono);
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--text-bright);
    }
    .skill-card .skill-desc {
      font-size: 0.7rem;
      color: var(--text-dim);
    }
    .skill-toggle {
      margin-left: auto;
      width: 18px;
      height: 18px;
      border-radius: 4px;
      border: 2px solid var(--border);
      background: transparent;
      transition: all 0.15s;
      flex-shrink: 0;
    }
    .skill-card.enabled .skill-toggle {
      background: var(--accent);
      border-color: var(--accent);
    }

    /* â”€â”€ Textarea â”€â”€ */
    .forge-textarea {
      width: 100%;
      min-height: 120px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 16px;
      font-family: var(--mono);
      font-size: 0.8rem;
      color: var(--text-bright);
      outline: none;
      resize: vertical;
      line-height: 1.6;
    }
    .forge-textarea:focus { border-color: var(--accent); }
    .forge-textarea::placeholder { color: var(--text-dim); }

    /* â”€â”€ Model select â”€â”€ */
    .model-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 10px;
    }
    .model-card {
      background: var(--surface);
      border: 2px solid var(--border);
      border-radius: 10px;
      padding: 16px;
      cursor: pointer;
      transition: border-color 0.2s, background 0.2s;
    }
    .model-card:hover { border-color: var(--border-active); }
    .model-card.selected { border-color: var(--accent); background: var(--accent-bg); }
    .model-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 4px;
    }
    .model-icon {
      width: 20px;
      height: 20px;
      color: var(--text-dim);
      flex-shrink: 0;
      transition: color 0.2s;
    }
    .model-card.selected .model-icon {
      color: var(--accent);
    }
    .model-name {
      font-family: var(--mono);
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--text-bright);
    }
    .model-provider {
      font-size: 0.7rem;
      color: var(--text-dim);
    }
    .model-badge {
      display: inline-block;
      font-family: var(--mono);
      font-size: 0.6rem;
      padding: 2px 8px;
      border-radius: 4px;
      background: var(--green);
      color: #000;
      font-weight: 700;
      margin-top: 6px;
    }

    /* â”€â”€ Sidebar â”€â”€ */
    .forge-sidebar {
      position: sticky;
      top: 60px;
      height: calc(100vh - 60px);
      border-left: 1px solid var(--border);
      background: var(--surface);
      padding: 32px 24px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }
    .sidebar-title {
      font-family: var(--mono);
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-dim);
      margin-bottom: 16px;
    }
    .sidebar-server-name {
      font-family: var(--sans);
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--text-bright);
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .sidebar-section {
      margin-bottom: 20px;
    }
    .sidebar-label {
      font-family: var(--mono);
      font-size: 0.65rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--text-dim);
      margin-bottom: 6px;
    }
    .sidebar-value {
      font-size: 0.85rem;
      color: var(--text-bright);
    }
    .sidebar-list {
      list-style: none;
    }
    .sidebar-list li {
      font-size: 0.8rem;
      color: var(--text);
      padding: 3px 0;
    }
    .sidebar-actions {
      margin-top: auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding-top: 24px;
      border-top: 1px solid var(--border);
    }
    .btn-forge {
      font-family: var(--mono);
      font-size: 0.8rem;
      font-weight: 700;
      padding: 14px 20px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      text-align: center;
      transition: all 0.15s;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }
    .btn-preview {
      background: var(--accent);
      color: #000;
    }
    .btn-preview:hover { background: #ff7070; }
    .btn-deploy {
      background: var(--surface-2);
      color: var(--text-bright);
      border: 1px solid var(--border);
    }
    .btn-deploy:hover { border-color: var(--accent); color: var(--accent); }
    .btn-save {
      background: transparent;
      color: var(--text);
      border: 1px solid var(--border);
    }
    .btn-save:hover { border-color: var(--text-dim); color: var(--text-bright); }

    /* â”€â”€ Workspace files â”€â”€ */
    .file-tabs {
      display: flex;
      gap: 0;
      border-bottom: 1px solid var(--border);
      margin-bottom: 0;
      overflow-x: auto;
    }
    .file-tab {
      font-family: var(--mono);
      font-size: 0.72rem;
      padding: 10px 16px;
      color: var(--text-dim);
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all 0.15s;
      white-space: nowrap;
      background: none;
      border-top: none;
      border-left: none;
      border-right: none;
    }
    .file-tab:hover { color: var(--text-bright); }
    .file-tab.active {
      color: var(--accent);
      border-bottom-color: var(--accent);
    }

    /* â”€â”€ Template picker â”€â”€ */
    .template-bar {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
      padding: 12px 16px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
    }
    .template-bar label {
      font-family: var(--mono);
      font-size: 0.7rem;
      color: var(--text-dim);
      text-transform: uppercase;
      letter-spacing: 0.06em;
      white-space: nowrap;
    }
    .template-select {
      flex: 1;
      min-width: 0;
      max-width: 100%;
      background: var(--surface-2);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 8px 12px;
      font-family: var(--mono);
      font-size: 0.8rem;
      color: var(--text-bright);
      outline: none;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .template-select:focus { border-color: var(--accent); }

    /* â”€â”€ Server name input â”€â”€ */
    .server-name-row {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-bottom: 32px;
    }
    .server-name-row input {
      flex: 1;
    }

    /* â”€â”€ Modal â”€â”€ */
    .modal-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(4px);
      z-index: 200;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .modal {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      max-width: 600px;
      width: 100%;
      padding: 32px;
      max-height: 90vh;
      overflow-y: auto;
    }
    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    .modal-title {
      font-family: var(--sans);
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--text-bright);
    }
    .modal-close {
      background: none;
      border: none;
      color: var(--text-dim);
      font-size: 1.5rem;
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 6px;
      transition: color 0.15s;
    }
    .modal-close:hover { color: var(--text-bright); }
    .modal-desc {
      font-size: 0.85rem;
      color: var(--text-dim);
      margin-bottom: 24px;
    }

    .deploy-grid {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .deploy-option {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px;
      background: var(--black);
      border: 1px solid var(--border);
      border-radius: 10px;
      cursor: pointer;
      transition: border-color 0.2s, background 0.2s;
    }
    .deploy-option:hover {
      border-color: var(--accent);
      background: var(--accent-bg);
    }
    .deploy-option.deploy-provider {
      opacity: 0.6;
      cursor: default;
    }
    .deploy-option.deploy-provider:hover {
      border-color: var(--border);
      background: var(--black);
    }
    .deploy-icon {
      flex-shrink: 0;
    }
    .deploy-icon svg {
      width: 24px;
      height: 24px;
      color: var(--text-dim);
    }
    .deploy-option:hover .deploy-icon svg {
      color: var(--accent);
    }
    .deploy-option.deploy-provider:hover .deploy-icon svg {
      color: var(--text-dim);
    }
    .deploy-info { flex: 1; }
    .deploy-name {
      font-family: var(--mono);
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--text-bright);
      margin-bottom: 2px;
    }
    .deploy-desc {
      font-size: 0.72rem;
      color: var(--text-dim);
    }
    .deploy-badge {
      font-family: var(--mono);
      font-size: 0.6rem;
      padding: 2px 8px;
      border-radius: 4px;
      background: var(--surface-2);
      border: 1px solid var(--border);
      color: var(--text-dim);
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }
    .deploy-divider {
      font-family: var(--mono);
      font-size: 0.65rem;
      color: var(--text-dim);
      text-transform: uppercase;
      letter-spacing: 0.08em;
      padding: 12px 0 4px;
      border-top: 1px solid var(--border);
      margin-top: 8px;
    }

    .command-label {
      font-family: var(--mono);
      font-size: 0.7rem;
      color: var(--text-dim);
      margin: 16px 0 8px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }
    .command-box {
      display: flex;
      align-items: center;
      background: var(--black);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 12px 16px;
      gap: 12px;
    }
    .command-box code {
      flex: 1;
      font-family: var(--mono);
      font-size: 0.78rem;
      color: var(--accent);
      word-break: break-all;
      user-select: all;
    }
    .command-copy {
      background: none;
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 6px 8px;
      cursor: pointer;
      color: var(--text-dim);
      transition: all 0.15s;
      flex-shrink: 0;
    }
    .command-copy:hover { border-color: var(--accent); color: var(--accent); }

    /* â”€â”€ Toast notifications â”€â”€ */
    .toast {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 14px 24px;
      font-family: var(--mono);
      font-size: 0.8rem;
      color: var(--text-bright);
      z-index: 1000;
      opacity: 0;
      transition: all 0.3s ease;
      pointer-events: none;
      box-shadow: 0 8px 24px rgba(0,0,0,0.4);
    }
    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
      pointer-events: auto;
    }
    .toast.success {
      border-color: var(--green);
      background: rgba(74,222,128,0.05);
      color: var(--green);
    }
    .toast.error {
      border-color: #f44;
      background: rgba(255,68,68,0.05);
      color: #f44;
    }

    /* â”€â”€ Left Preview Chat Panel â”€â”€ */
    .forge-preview-chat {
      position: fixed;
      top: 60px;
      left: 0;
      bottom: 0;
      width: 380px;
      display: none;
      flex-direction: column;
      border-right: 1px solid var(--border);
      background: var(--surface);
      overflow: hidden;
      z-index: 200;
      box-shadow: 4px 0 20px rgba(0,0,0,0.4);
      transition: transform 0.25s ease, opacity 0.25s ease;
    }
    .forge-preview-chat.active {
      display: flex;
    }
    /* Collapsed = minimised to a tab on the left edge */
    .forge-preview-chat.collapsed {
      transform: translateX(-100%);
      opacity: 0;
      pointer-events: none;
    }
    /* Retrieve tab â€” visible when collapsed */
    .preview-retrieve-tab {
      position: fixed;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      z-index: 201;
      background: var(--surface);
      border: 1px solid var(--border);
      border-left: none;
      border-radius: 0 8px 8px 0;
      padding: 12px 8px;
      cursor: pointer;
      color: var(--text-dim);
      display: none;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      font-size: 0.65rem;
      font-family: var(--mono);
      writing-mode: vertical-lr;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      transition: all 0.15s;
      box-shadow: 2px 0 10px rgba(0,0,0,0.3);
    }
    .preview-retrieve-tab:hover { border-color: var(--accent); color: var(--accent); }
    .preview-retrieve-tab.visible { display: flex; }
    .preview-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 12px;
      border-bottom: 1px solid var(--border);
      background: var(--black);
      flex-shrink: 0;
      gap: 6px;
    }
    .preview-title {
      font-family: var(--mono);
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--text-dim);
      display: flex;
      align-items: center;
      gap: 6px;
      flex: 1;
      min-width: 0;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .preview-header-actions {
      display: flex;
      gap: 4px;
      flex-shrink: 0;
    }
    .preview-hdr-btn {
      background: none;
      border: 1px solid var(--border);
      border-radius: 5px;
      padding: 3px 7px;
      cursor: pointer;
      color: var(--text-dim);
      font-size: 0.7rem;
      transition: all 0.15s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .preview-hdr-btn:hover { border-color: var(--accent); color: var(--accent); }
    .preview-hdr-btn.active { border-color: var(--accent); color: var(--accent); background: var(--accent-bg); }
    .preview-hdr-btn svg { width: 11px; height: 11px; }
    .preview-messages {
      flex: 1;
      overflow-y: auto;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      scrollbar-width: thin;
      scrollbar-color: var(--border) transparent;
      min-height: 0;
    }
    .preview-msg {
      display: flex;
      gap: 8px;
      max-width: 90%;
    }
    .preview-msg.user {
      align-self: flex-end;
      flex-direction: row-reverse;
    }
    .preview-msg-avatar {
      width: 24px;
      height: 24px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      font-size: 0.8rem;
    }
    .preview-msg.user .preview-msg-avatar {
      background: var(--accent-bg);
      border: 1px solid rgba(255,92,92,0.15);
    }
    .preview-msg.assistant .preview-msg-avatar {
      background: var(--surface-2);
      border: 1px solid var(--border);
    }
    .preview-msg-bubble {
      border-radius: 10px;
      padding: 8px 12px;
      font-size: 0.8rem;
      line-height: 1.5;
      word-wrap: break-word;
      white-space: pre-wrap;
    }
    .preview-msg.user .preview-msg-bubble {
      background: var(--accent-bg);
      border: 1px solid rgba(255,92,92,0.12);
      color: var(--text-bright);
      border-top-right-radius: 3px;
    }
    .preview-msg.assistant .preview-msg-bubble {
      background: transparent;
      color: var(--text);
      border: 1px solid var(--border);
      border-top-left-radius: 3px;
    }
    .preview-msg.assistant .preview-msg-bubble code {
      font-family: var(--mono);
      font-size: 0.75em;
      background: var(--black);
      border: 1px solid var(--border);
      border-radius: 3px;
      padding: 1px 4px;
      color: var(--accent);
    }
    /* Code blocks in preview */
    .preview-msg-bubble pre {
      background: var(--black);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 10px 12px;
      margin: 6px 0;
      overflow-x: auto;
      font-size: 0.75rem;
      line-height: 1.5;
      position: relative;
    }
    .preview-msg-bubble pre code {
      background: none !important;
      border: none !important;
      padding: 0 !important;
      color: var(--text) !important;
      font-size: inherit;
    }
    .preview-code-lang {
      position: absolute;
      top: 4px;
      right: 8px;
      font-family: var(--mono);
      font-size: 0.6rem;
      color: var(--text-dim);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .preview-code-copy {
      position: absolute;
      top: 4px;
      right: 8px;
      background: none;
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 2px 6px;
      cursor: pointer;
      color: var(--text-dim);
      font-family: var(--mono);
      font-size: 0.55rem;
      opacity: 0;
      transition: opacity 0.15s;
    }
    .preview-msg-bubble pre:hover .preview-code-copy { opacity: 1; }
    .preview-code-copy:hover { border-color: var(--accent); color: var(--accent); }
    /* Lists in preview */
    .preview-msg-bubble ul, .preview-msg-bubble ol {
      margin: 4px 0;
      padding-left: 18px;
    }
    .preview-msg-bubble li { margin: 2px 0; }
    /* Headers in preview */
    .preview-msg-bubble h1, .preview-msg-bubble h2, .preview-msg-bubble h3 {
      color: var(--text-bright);
      margin: 8px 0 4px;
      font-size: 0.85rem;
    }
    .preview-msg-bubble h1 { font-size: 0.95rem; }
    .preview-msg-bubble blockquote {
      border-left: 2px solid var(--accent);
      padding-left: 10px;
      margin: 6px 0;
      color: var(--text-dim);
      font-style: italic;
    }
    .preview-empty {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: 8px;
      color: var(--text-dim);
      font-size: 0.75rem;
      text-align: center;
      padding: 20px;
    }
    .preview-empty svg {
      width: 28px;
      height: 28px;
      color: var(--border-active);
    }
    .preview-input-bar {
      padding: 12px;
      border-top: 1px solid var(--border);
      background: var(--black);
      flex-shrink: 0;
    }
    .preview-input-row {
      display: flex;
      gap: 6px;
      align-items: flex-end;
    }
    .preview-input {
      flex: 1;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 8px 10px;
      font-family: var(--sans);
      font-size: 0.8rem;
      color: var(--text-bright);
      outline: none;
      resize: none;
      max-height: 80px;
      line-height: 1.4;
    }
    .preview-input:focus { border-color: var(--accent); }
    .preview-input::placeholder { color: var(--text-dim); }
    .preview-send {
      background: var(--accent);
      border: none;
      border-radius: 6px;
      padding: 8px 12px;
      cursor: pointer;
      color: #000;
      transition: background 0.15s;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }
    .preview-send:hover { background: #ff7070; }
    .preview-send:disabled { opacity: 0.4; cursor: not-allowed; }
    .preview-send svg { width: 12px; height: 12px; }
    .preview-loading {
      display: inline-flex;
      gap: 3px;
      align-items: center;
      padding: 2px 0;
    }
    .preview-loading span {
      width: 3px;
      height: 3px;
      border-radius: 50%;
      background: var(--text-dim);
      animation: dotPulse 1.4s ease-in-out infinite;
    }
    .preview-loading span:nth-child(2) { animation-delay: 0.2s; }
    .preview-loading span:nth-child(3) { animation-delay: 0.4s; }

    /* â”€â”€ Responsive â”€â”€ */
    @media (max-width: 900px) {
      .forge-layout {
        grid-template-columns: 1fr;
      }
      .forge-preview-chat {
        width: 100% !important;
        right: 0;
        border-right: none;
      }
      .forge-sidebar {
        position: relative;
        top: 0;
        height: auto;
        border-left: none;
        border-top: 1px solid var(--border);
      }
      .forge-main {
        padding: 32px 20px 60px;
      }
    }
    @media (max-width: 600px) {
      .option-grid { grid-template-columns: 1fr; }
      .skill-grid { grid-template-columns: 1fr; }
      .model-grid { grid-template-columns: 1fr; }
      .agent-row { grid-template-columns: 36px 1fr auto; }
      .agent-row > :nth-child(2) { grid-column: 2 / 4; }
      .agent-row > :nth-child(3) { grid-column: 2 / 4; }
      .toast { bottom: 16px; }
    }
  </style>
</head>
<body>

  <!-- Nav -->
  <nav class="nav" role="navigation" aria-label="Main navigation">
    <a href="/" class="nav-brand" aria-label="vibeclaw home"><img src="/crab-nav.png" alt="" style="height:36px;vertical-align:middle;margin-right:6px;"><span style="font-size:1rem;font-weight:700;"><span style="color:var(--accent);">VIBE</span><span style="color:var(--text-bright);">CLAW</span></span></a>
    <div class="nav-links">
      <a href="/library.html"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="width:12px;height:12px;display:inline;vertical-align:-1px;margin-right:4px;"><path d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 002 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0022 16z"/></svg>My Servers</a>
      <a href="/news.html">Articles</a>
      <!-- <a href="/chat.html"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="width:12px;height:12px;display:inline;vertical-align:-1px;margin-right:4px;"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>Chat</a> -->
      <a href="/" style="display:inline-flex;align-items:center;gap:4px;text-decoration:none;"><img src="/crab-nav.png" alt="" style="height:36px;"><span style="font-family:var(--mono);font-size:1rem;font-weight:700;"><span style="color:var(--accent);">VIBE</span><span style="color:var(--text-bright);">CLAW</span></span></a>
      <span id="upgrade-container" style="margin-left:4px;"></span>
      <span id="auth-container" style="margin-left:4px;"></span>
    </div>
  </nav>

  <!-- Retrieve tab (visible when preview is collapsed) -->
  <div class="preview-retrieve-tab" id="preview-retrieve" title="Open preview chat">
    ðŸ’¬ Preview
  </div>

  <!-- Preview Chat Panel (fixed overlay, outside grid) -->
  <div class="forge-preview-chat" id="preview-chat">
    <div class="preview-header">
      <div class="preview-title">
        <span id="preview-title-text">ðŸ’¬ Preview</span>
      </div>
      <div class="preview-header-actions">
        <button class="preview-hdr-btn" id="preview-pin" title="Pin open">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 17v5"/><path d="M9 11V4a1 1 0 011-1h4a1 1 0 011 1v7"/><path d="M5 11h14l-1.5 6H6.5z"/></svg>
        </button>
        <button class="preview-hdr-btn" id="preview-collapse" title="Collapse">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 14 10 14 10 20"/><polyline points="20 10 14 10 14 4"/><line x1="14" y1="10" x2="21" y2="3"/><line x1="3" y1="21" x2="10" y2="14"/></svg>
        </button>
        <button class="preview-hdr-btn" id="preview-clear" title="Clear chat">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/></svg>
        </button>
        <button class="preview-hdr-btn" id="preview-close" title="Close">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
        </button>
      </div>
    </div>
    <div class="preview-messages" id="preview-messages">
      <div class="preview-empty">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>
        <p>Type a message to test your agent</p>
      </div>
    </div>
    <div class="preview-input-bar">
      <div class="preview-input-row">
        <textarea id="preview-input" class="preview-input" placeholder="Message..." rows="1"></textarea>
        <button id="preview-send" class="preview-send">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Layout -->
  <main>
  <div class="forge-layout" id="forge-layout">
    <!-- Main configurator -->
    <article class="forge-main">
      <h1 class="forge-title">Build your server</h1>
      <p class="forge-subtitle">Configure your OpenClaw server. Preview it live. Deploy it anywhere.</p>

      <!-- Template picker -->
      <div class="template-bar">
        <label>Start from</label>
        <select id="template-select" class="template-select">
          <option value="">Blank server</option>
        </select>
      </div>

      <!-- Server name -->
      <div class="server-name-row">
        <input id="server-emoji" class="agent-emoji-input" type="text" value="ðŸ¦€" maxlength="4" />
        <input id="server-name" class="agent-text-input" type="text" placeholder="My Server" value="My Server" style="flex:1;font-size:1.1rem;padding:12px 16px;" />
      </div>

      <!-- Step 1: Runtime -->
      <div class="step">
        <div class="step-header">
          <span class="step-num">01</span>
          <span class="step-title">Runtime</span>
        </div>
        <p class="step-desc">Choose your server's core mode.</p>
        <div class="option-grid" id="runtime-options">
          <div class="option-card selected" data-value="single">
            <div class="option-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg></div>
            <div class="option-name">Standard</div>
            <div class="option-desc">Single agent, clean and fast</div>
          </div>
          <div class="option-card" data-value="multi">
            <div class="option-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="7" r="3"/><circle cx="17" cy="7" r="3"/><path d="M3 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/><path d="M17 14a4 4 0 014 4v2"/></svg></div>
            <div class="option-name">Multi-Agent</div>
            <div class="option-desc">Agent squads with team routing</div>
          </div>
          <div class="option-card" data-value="minimal">
            <div class="option-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg></div>
            <div class="option-name">Minimal</div>
            <div class="option-desc">Lightweight, low-resource mode</div>
          </div>
        </div>
      </div>

      <!-- Step 2: Agents -->
      <div class="step">
        <div class="step-header">
          <span class="step-num">02</span>
          <span class="step-title">Agents</span>
        </div>
        <p class="step-desc">Add agents to your server. The first agent is the lead.</p>
        <div class="agent-list" id="agent-list">
          <div class="agent-row active" data-idx="0">
            <input type="text" class="agent-emoji-input" value="ðŸ¦€" maxlength="4" data-field="emoji" />
            <input type="text" class="agent-text-input" placeholder="Agent name" value="Claw" data-field="name" />
            <input type="text" class="agent-text-input" placeholder="Role / description" value="General-purpose coding assistant" data-field="desc" />
            <span style="font-size:0.65rem;color:var(--text-dim);font-family:var(--mono);">LEAD</span>
          </div>
        </div>
        <button class="btn-add" id="add-agent-btn">+ Add Agent</button>
      </div>

      <!-- Step 3: Skills -->
      <div class="step">
        <div class="step-header">
          <span class="step-num">03</span>
          <span class="step-title">Skills</span>
        </div>
        <p class="step-desc">Toggle the skills your server should have.</p>
        <div class="skill-grid" id="skill-grid">
          <div class="skill-card enabled" data-skill="chat">
            <span class="skill-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg></span>
            <div>
              <div class="skill-name">Chat</div>
              <div class="skill-desc">Conversational AI via LLM</div>
            </div>
            <div class="skill-toggle"></div>
          </div>
          <div class="skill-card enabled" data-skill="filesystem">
            <span class="skill-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg></span>
            <div>
              <div class="skill-name">Filesystem</div>
              <div class="skill-desc">Read, write, and manage files</div>
            </div>
            <div class="skill-toggle"></div>
          </div>
          <div class="skill-card enabled" data-skill="execute">
            <span class="skill-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 17 10 11 4 5"/><line x1="12" y1="19" x2="20" y2="19"/></svg></span>
            <div>
              <div class="skill-name">Execute</div>
              <div class="skill-desc">Run shell commands</div>
            </div>
            <div class="skill-toggle"></div>
          </div>
          <div class="skill-card" data-skill="web-browse">
            <span class="skill-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z"/></svg></span>
            <div>
              <div class="skill-name">Web Browse</div>
              <div class="skill-desc">Search and fetch web pages</div>
            </div>
            <div class="skill-toggle"></div>
          </div>
          <div class="skill-card" data-skill="github">
            <span class="skill-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0020 4.77 5.07 5.07 0 0019.91 1S18.73.65 16 2.48a13.38 13.38 0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 005 4.77a5.44 5.44 0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 009 18.13V22"/></svg></span>
            <div>
              <div class="skill-name">GitHub</div>
              <div class="skill-desc">PRs, issues, repos, CI</div>
            </div>
            <div class="skill-toggle"></div>
          </div>
          <div class="skill-card" data-skill="docker">
            <span class="skill-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="6" width="20" height="12" rx="2"/><path d="M6 6V4a2 2 0 012-2h8a2 2 0 012 2v2"/><line x1="10" y1="11" x2="10" y2="13"/><line x1="14" y1="11" x2="14" y2="13"/></svg></span>
            <div>
              <div class="skill-name">Docker</div>
              <div class="skill-desc">Container build & deploy</div>
            </div>
            <div class="skill-toggle"></div>
          </div>
          <div class="skill-card" data-skill="image-gen">
            <span class="skill-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg></span>
            <div>
              <div class="skill-name">Image Gen</div>
              <div class="skill-desc">Generate and edit images</div>
            </div>
            <div class="skill-toggle"></div>
          </div>
          <div class="skill-card" data-skill="scheduling">
            <span class="skill-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg></span>
            <div>
              <div class="skill-name">Scheduling</div>
              <div class="skill-desc">Cron jobs and reminders</div>
            </div>
            <div class="skill-toggle"></div>
          </div>
          <div class="skill-card" data-skill="browser-auto">
            <span class="skill-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M8 12l3 3 5-5"/></svg></span>
            <div>
              <div class="skill-name">Browser Auto</div>
              <div class="skill-desc">Navigate, click, fill, screenshot</div>
            </div>
            <div class="skill-toggle"></div>
          </div>
          <div class="skill-card" data-skill="security">
            <span class="skill-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg></span>
            <div>
              <div class="skill-name">Security</div>
              <div class="skill-desc">Vuln scan, threat modeling</div>
            </div>
            <div class="skill-toggle"></div>
          </div>
          <div class="skill-card" data-skill="email">
            <span class="skill-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22 6 12 13 2 6"/></svg></span>
            <div>
              <div class="skill-name">Email</div>
              <div class="skill-desc">Read and send emails</div>
            </div>
            <div class="skill-toggle"></div>
          </div>
          <div class="skill-card" data-skill="calendar">
            <span class="skill-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg></span>
            <div>
              <div class="skill-name">Calendar</div>
              <div class="skill-desc">Events and scheduling</div>
            </div>
            <div class="skill-toggle"></div>
          </div>
        </div>
      </div>

      <!-- Step 4: Personality -->
      <div class="step">
        <div class="step-header">
          <span class="step-num">04</span>
          <span class="step-title">Personality</span>
        </div>
        <p class="step-desc">Define how your agent behaves. This becomes the system prompt.</p>
        <textarea id="system-prompt" class="forge-textarea" placeholder="You are a helpful coding assistant. Be concise, direct, and pragmatic...">You are ðŸ¦€ Claw, a helpful coding assistant. Be concise, direct, and pragmatic. Show code, not just descriptions. Always explain the 'why' behind your suggestions.</textarea>
      </div>

      <!-- Step 5: Workspace Files -->
      <div class="step">
        <div class="step-header">
          <span class="step-num">05</span>
          <span class="step-title">Workspace Files</span>
        </div>
        <p class="step-desc">Set up the markdown files that define your agent's memory, identity, and tools.</p>
        <div class="file-tabs" id="file-tabs">
          <button class="file-tab active" data-file="AGENTS.md">AGENTS.md</button>
          <button class="file-tab" data-file="SOUL.md">SOUL.md</button>
          <button class="file-tab" data-file="USER.md">USER.md</button>
          <button class="file-tab" data-file="TOOLS.md">TOOLS.md</button>
        </div>
        <textarea id="file-editor" class="forge-textarea" style="border-top-left-radius:0;border-top-right-radius:0;min-height:160px;">## My Agent

This is your agent's workspace configuration. Define how it operates, what it remembers, and how it interacts.

## Memory

Update this file as you learn about the workspace and user preferences.</textarea>
      </div>

      <!-- Step 6: Model -->
      <div class="step">
        <div class="step-header">
          <span class="step-num">06</span>
          <span class="step-title">Model</span>
        </div>
        <p class="step-desc">Choose the LLM that powers your server.</p>
        <div class="model-grid" id="model-grid">
          <div class="model-card selected" data-model="upstage/solar-pro-3:free">
            <div class="model-header">
              <svg class="model-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="3"/><path d="M12 1v4m0 14v4M4.22 4.22l2.83 2.83m9.9 9.9l2.83 2.83M1 12h4m14 0h4M4.22 19.78l2.83-2.83m9.9-9.9l2.83-2.83"/></svg>
              <div class="model-name">Solar Pro 3</div>
            </div>
            <div class="model-provider">Upstage</div>
            <span class="model-badge">FREE</span>
          </div>
          <div class="model-card" data-model="qwen/qwen3-8b:free">
            <div class="model-header">
              <svg class="model-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
              <div class="model-name">Qwen3 8B</div>
            </div>
            <div class="model-provider">Alibaba</div>
            <span class="model-badge">FREE</span>
          </div>
          <div class="model-card" data-model="microsoft/phi-4-reasoning:free">
            <div class="model-header">
              <svg class="model-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="8" height="8"/><rect x="13" y="3" width="8" height="8"/><rect x="3" y="13" width="8" height="8"/><rect x="13" y="13" width="8" height="8"/></svg>
              <div class="model-name">Phi-4 Reasoning</div>
            </div>
            <div class="model-provider">Microsoft</div>
            <span class="model-badge">FREE</span>
          </div>
          <div class="model-card" data-model="google/gemma-3-4b-it:free">
            <div class="model-header">
              <svg class="model-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 3l1.5 4.5H18l-3.5 2.5L16 15l-4-3-4 3 1.5-5L6 7.5h4.5z"/></svg>
              <div class="model-name">Gemma 3 4B</div>
            </div>
            <div class="model-provider">Google</div>
            <span class="model-badge">FREE</span>
          </div>
          <div class="model-card" data-model="mistralai/mistral-small-3.1-24b-instruct:free">
            <div class="model-header">
              <svg class="model-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 2v4m0 12v4M6 8l-3-2m18 2l-3-2M6 16l-3 2m18-2l-3 2"/><circle cx="12" cy="12" r="4"/></svg>
              <div class="model-name">Mistral Small 3.1</div>
            </div>
            <div class="model-provider">Mistral AI</div>
            <span class="model-badge">FREE</span>
          </div>
          <!-- Pro models â€” visible in preview mode -->
          <!-- Pro models â€” visible in preview mode -->
          <div class="model-card pro-model" data-model="anthropic/claude-opus-4.6" style="display:none;">
            <div class="model-header">
              <svg class="model-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"/><path d="M8 12l3 3 5-5"/></svg>
              <div class="model-name">Claude Opus 4.6</div>
            </div>
            <div class="model-provider">Anthropic</div>
            <span class="model-badge" style="background:linear-gradient(135deg,rgba(255,92,92,0.15),rgba(255,150,50,0.15));color:var(--accent);border-color:rgba(255,92,92,0.3);">PRO</span>
          </div>
          <div class="model-card pro-model" data-model="anthropic/claude-sonnet-4.5" style="display:none;">
            <div class="model-header">
              <svg class="model-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"/><path d="M8 12l3 3 5-5"/></svg>
              <div class="model-name">Claude Sonnet 4.5</div>
            </div>
            <div class="model-provider">Anthropic</div>
            <span class="model-badge" style="background:linear-gradient(135deg,rgba(255,92,92,0.15),rgba(255,150,50,0.15));color:var(--accent);border-color:rgba(255,92,92,0.3);">PRO</span>
          </div>
          <div class="model-card pro-model" data-model="openai/gpt-5.2" style="display:none;">
            <div class="model-header">
              <svg class="model-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
              <div class="model-name">GPT-5.2</div>
            </div>
            <div class="model-provider">OpenAI</div>
            <span class="model-badge" style="background:linear-gradient(135deg,rgba(255,92,92,0.15),rgba(255,150,50,0.15));color:var(--accent);border-color:rgba(255,92,92,0.3);">PRO</span>
          </div>
          <div class="model-card pro-model" data-model="google/gemini-3-pro-preview" style="display:none;">
            <div class="model-header">
              <svg class="model-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 3l1.5 4.5H18l-3.5 2.5L16 15l-4-3-4 3 1.5-5L6 7.5h4.5z"/></svg>
              <div class="model-name">Gemini 3 Pro</div>
            </div>
            <div class="model-provider">Google</div>
            <span class="model-badge" style="background:linear-gradient(135deg,rgba(255,92,92,0.15),rgba(255,150,50,0.15));color:var(--accent);border-color:rgba(255,92,92,0.3);">PRO</span>
          </div>
          <div class="model-card pro-model" data-model="openai/o3" style="display:none;">
            <div class="model-header">
              <svg class="model-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/><path d="M12 8v8"/></svg>
              <div class="model-name">o3</div>
            </div>
            <div class="model-provider">OpenAI</div>
            <span class="model-badge" style="background:linear-gradient(135deg,rgba(255,92,92,0.15),rgba(255,150,50,0.15));color:var(--accent);border-color:rgba(255,92,92,0.3);">PRO</span>
          </div>
        </div>
      </div>

    </div>

    </article>

    <!-- Sidebar -->
    <div class="forge-sidebar">
      <div class="sidebar-title" style="display:flex;align-items:center;justify-content:space-between;">Your Server <span id="draft-status" style="font-size:0.6rem;font-weight:400;color:var(--text-dim);opacity:0;transition:opacity 0.3s;"></span></div>
      <div class="sidebar-server-name" id="sidebar-name">
        <span id="sidebar-emoji"><svg viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="width:20px;height:20px;"><rect x="3" y="3" width="18" height="14" rx="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg></span>
        <span id="sidebar-name-text">My Server</span>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-label">Runtime</div>
        <div class="sidebar-value" id="sidebar-runtime">Standard</div>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-label">Agents</div>
        <ul class="sidebar-list" id="sidebar-agents">
          <li>Claw</li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-label">Skills</div>
        <ul class="sidebar-list" id="sidebar-skills">
          <li>Chat</li>
          <li>Filesystem</li>
          <li>Execute</li>
        </ul>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-label">Model</div>
        <div class="sidebar-value" id="sidebar-model">Solar Pro 3</div>
      </div>

      <div class="sidebar-actions">
        <button class="btn-forge btn-preview" id="preview-btn"><svg viewBox="0 0 24 24" fill="currentColor" style="width:12px;height:12px;display:inline;vertical-align:-1px;margin-right:6px;"><polygon points="5 3 19 12 5 21 5 3"/></svg>Preview</button>
        <button class="btn-forge btn-deploy" id="deploy-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="width:14px;height:14px;display:inline;vertical-align:-2px;margin-right:6px;"><path d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 002 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0022 16z"/></svg>Deploy</button>
        <button class="btn-forge btn-save" id="save-btn"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="width:14px;height:14px;display:inline;vertical-align:-2px;margin-right:6px;"><path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>Save</button>
      </div>
    </div>
  </div>
  </main>

  <!-- Deploy Modal -->
  <div id="deploy-modal" class="modal-overlay" style="display:none;">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title">Deploy your server</h2>
        <button class="modal-close" id="deploy-close">&times;</button>
      </div>
      <p class="modal-desc">Your server spec is ready. Choose how you want to deploy it.</p>

      <div class="deploy-grid">
        <!-- Download -->
        <div class="deploy-option" id="deploy-download">
          <div class="deploy-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg></div>
          <div class="deploy-info">
            <div class="deploy-name">Download Package</div>
            <div class="deploy-desc">openclaw.json config, workspace files, setup script, and README</div>
          </div>
        </div>

        <!-- JSON Spec -->
        <div class="deploy-option" id="deploy-json">
          <div class="deploy-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg></div>
          <div class="deploy-info">
            <div class="deploy-name">Server Spec (JSON)</div>
            <div class="deploy-desc">Download the raw server specification file</div>
          </div>
        </div>

        <!-- Quick install -->
        <div class="deploy-option" id="deploy-docker">
          <div class="deploy-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 17 10 11 4 5"/><line x1="12" y1="19" x2="20" y2="19"/></svg></div>
          <div class="deploy-info">
            <div class="deploy-name">Quick Install</div>
            <div class="deploy-desc">One-line install script â€” installs OpenClaw and starts the gateway</div>
          </div>
        </div>

        <!-- npm -->
        <div class="deploy-option" id="deploy-cli">
          <div class="deploy-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 002 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0022 16z"/></svg></div>
          <div class="deploy-info">
            <div class="deploy-name">npm</div>
            <div class="deploy-desc">Install via npm and run the setup wizard</div>
          </div>
        </div>

        <!-- One-click providers -->
        <div class="deploy-divider">One-click deploy</div>

        <div class="deploy-option deploy-provider" id="deploy-railway">
          <div class="deploy-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="4" y="2" width="16" height="20" rx="2"/><line x1="4" y1="7" x2="20" y2="7"/><line x1="4" y1="12" x2="20" y2="12"/><line x1="4" y1="17" x2="20" y2="17"/></svg></div>
          <div class="deploy-info">
            <div class="deploy-name">Railway</div>
            <div class="deploy-desc">Deploy to Railway with one click</div>
          </div>
          <span class="deploy-badge">soon</span>
        </div>

        <div class="deploy-option deploy-provider" id="deploy-flyio">
          <div class="deploy-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 2L11 13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg></div>
          <div class="deploy-info">
            <div class="deploy-name">Fly.io</div>
            <div class="deploy-desc">Deploy to Fly.io globally</div>
          </div>
          <span class="deploy-badge">soon</span>
        </div>

        <div class="deploy-option deploy-provider" id="deploy-render">
          <div class="deploy-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg></div>
          <div class="deploy-info">
            <div class="deploy-name">Render</div>
            <div class="deploy-desc">Deploy as a Render web service</div>
          </div>
          <span class="deploy-badge">soon</span>
        </div>
      </div>

      <!-- Command preview area -->
      <div id="deploy-command-area" style="display:none;">
        <div class="command-label" id="deploy-command-label"></div>
        <div class="command-box">
          <code id="deploy-command-text"></code>
          <button class="command-copy" id="deploy-copy-btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="width:14px;height:14px;"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast notification -->
  <div id="toast" class="toast"></div>

  <script>
    // â”€â”€ Toast notification system â”€â”€
    function showToast(message, type = 'success', duration = 3000) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = 'toast show ' + type;
      setTimeout(() => {
        toast.classList.remove('show');
      }, duration);
    }

    // â”€â”€ State â”€â”€
    const state = {
      emoji: 'ðŸ¦€',
      name: 'My Server',
      runtime: 'single',
      agents: [
        { emoji: 'ðŸ¦€', name: 'Claw', desc: 'General-purpose coding assistant' }
      ],
      skills: new Set(['chat', 'filesystem', 'execute']),
      systemPrompt: '',
      files: {
        'AGENTS.md': '## My Agent\n\nThis is your agent\'s workspace configuration. Define how it operates, what it remembers, and how it interacts.\n\n## Memory\n\nUpdate this file as you learn about the workspace and user preferences.',
        'SOUL.md': '# Soul\n\nBe helpful, concise, and direct. Have opinions. Show code, not just words.',
        'USER.md': '# About the User\n\nAdd notes about the user\'s preferences, timezone, and workflow here.',
        'TOOLS.md': '# Tools\n\nNote down tool-specific config: camera names, SSH hosts, API endpoints, etc.'
      },
      activeFile: 'AGENTS.md',
      model: 'upstage/solar-pro-3:free',
    };

    let allFlavours = [];

    // â”€â”€ Helpers â”€â”€
    const $ = id => document.getElementById(id);
    const $$ = sel => document.querySelectorAll(sel);

    // â”€â”€ Auto-save draft â”€â”€
    let _draftTimer = null;
    const DRAFT_KEY = 'clawforge-draft';
    function saveDraft() {
      clearTimeout(_draftTimer);
      _draftTimer = setTimeout(() => {
        try {
          // Save current file editor content
          state.files[state.activeFile] = $('file-editor').value;
          state.systemPrompt = $('system-prompt').value;
          const draft = {
            emoji: state.emoji,
            name: state.name,
            runtime: state.runtime,
            agents: state.agents,
            skills: [...state.skills],
            systemPrompt: state.systemPrompt,
            files: state.files,
            activeFile: state.activeFile,
            model: state.model,
            savedAt: Date.now()
          };
          localStorage.setItem(DRAFT_KEY, JSON.stringify(draft));
          // Flash draft status
          const ds = $('draft-status');
          if (ds) {
            ds.textContent = 'Draft saved';
            ds.style.opacity = '1';
            clearTimeout(ds._fadeTimer);
            ds._fadeTimer = setTimeout(() => { ds.style.opacity = '0'; }, 2000);
          }
        } catch (e) { console.warn('Draft save error:', e); }
      }, 500);
    }

    function updateSidebar() {
      saveDraft();
      // Show user emoji if set, otherwise show server icon
      const emojiEl = $('sidebar-emoji');
      if (state.emoji && state.emoji.trim()) {
        emojiEl.textContent = state.emoji;
        emojiEl.style.fontSize = '1.3rem';
      }
      $('sidebar-name-text').textContent = state.name;

      const runtimeNames = { single: 'Standard', multi: 'Multi-Agent', minimal: 'Minimal' };
      $('sidebar-runtime').textContent = runtimeNames[state.runtime] || state.runtime;

      const agentIcon = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:12px;height:12px;vertical-align:-1px;margin-right:4px;"><circle cx="12" cy="7" r="4"/><path d="M5.5 21a6.5 6.5 0 0113 0"/></svg>';
      $('sidebar-agents').innerHTML = state.agents
        .map(a => `<li>${agentIcon}${escHtml(a.name || 'Unnamed')}</li>`).join('');

      const skillIcons = {
        'chat': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:12px;height:12px;vertical-align:-1px;margin-right:4px;"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>',
        'filesystem': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:12px;height:12px;vertical-align:-1px;margin-right:4px;"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg>',
        'execute': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:12px;height:12px;vertical-align:-1px;margin-right:4px;"><polyline points="4 17 10 11 4 5"/><line x1="12" y1="19" x2="20" y2="19"/></svg>',
        'web-browse': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:12px;height:12px;vertical-align:-1px;margin-right:4px;"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/></svg>',
        'github': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:12px;height:12px;vertical-align:-1px;margin-right:4px;"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0020 4.77 5.07 5.07 0 0019.91 1S18.73.65 16 2.48a13.38 13.38 0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 005 4.77a5.44 5.44 0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 009 18.13V22"/></svg>',
        'docker': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:12px;height:12px;vertical-align:-1px;margin-right:4px;"><rect x="2" y="6" width="20" height="12" rx="2"/></svg>',
        'image-gen': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:12px;height:12px;vertical-align:-1px;margin-right:4px;"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>',
        'scheduling': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:12px;height:12px;vertical-align:-1px;margin-right:4px;"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>',
        'browser-auto': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:12px;height:12px;vertical-align:-1px;margin-right:4px;"><rect x="3" y="3" width="18" height="18" rx="2"/><path d="M8 12l3 3 5-5"/></svg>',
        'security': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:12px;height:12px;vertical-align:-1px;margin-right:4px;"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>',
        'email': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:12px;height:12px;vertical-align:-1px;margin-right:4px;"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22 6 12 13 2 6"/></svg>',
        'calendar': '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="width:12px;height:12px;vertical-align:-1px;margin-right:4px;"><rect x="3" y="4" width="18" height="18" rx="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>',
      };
      const skillLabels = {
        'chat': 'Chat', 'filesystem': 'Filesystem', 'execute': 'Execute',
        'web-browse': 'Web Browse', 'github': 'GitHub', 'docker': 'Docker',
        'image-gen': 'Image Gen', 'scheduling': 'Scheduling', 'browser-auto': 'Browser Auto',
        'security': 'Security', 'email': 'Email', 'calendar': 'Calendar',
      };
      $('sidebar-skills').innerHTML = [...state.skills]
        .map(s => `<li>${skillIcons[s] || ''}${skillLabels[s] || s}</li>`).join('');

      const modelEl = document.querySelector('.model-card.selected');
      $('sidebar-model').textContent = modelEl
        ? modelEl.querySelector('.model-name').textContent
        : state.model.split('/').pop();
    }

    // â”€â”€ Server name â”€â”€
    $('server-emoji').addEventListener('input', e => {
      state.emoji = e.target.value || 'ðŸ¦€';
      updateSidebar();
    });
    $('server-name').addEventListener('input', e => {
      state.name = e.target.value || 'My Server';
      updateSidebar();
    });

    // â”€â”€ Runtime â”€â”€
    $$('#runtime-options .option-card').forEach(card => {
      card.addEventListener('click', () => {
        $$('#runtime-options .option-card').forEach(c => c.classList.remove('selected'));
        card.classList.add('selected');
        state.runtime = card.dataset.value;
        updateSidebar();
      });
    });

    // â”€â”€ Agents â”€â”€
    function renderAgents() {
      const list = $('agent-list');
      list.innerHTML = state.agents.map((a, i) => `
        <div class="agent-row ${i === 0 ? 'active' : ''}" data-idx="${i}">
          <input type="text" class="agent-emoji-input" value="${a.emoji}" maxlength="4" data-field="emoji" />
          <input type="text" class="agent-text-input" placeholder="Agent name" value="${escHtml(a.name)}" data-field="name" />
          <input type="text" class="agent-text-input" placeholder="Role / description" value="${escHtml(a.desc)}" data-field="desc" />
          ${i === 0
            ? '<span style="font-size:0.65rem;color:var(--text-dim);font-family:var(--mono);">LEAD</span>'
            : '<button class="btn-small danger" data-remove="' + i + '"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:10px;height:10px;"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>'
          }
        </div>
      `).join('');

      // Bind inputs
      list.querySelectorAll('.agent-row').forEach(row => {
        const idx = parseInt(row.dataset.idx);
        row.querySelectorAll('input').forEach(inp => {
          inp.addEventListener('input', () => {
            state.agents[idx][inp.dataset.field] = inp.value;
            updateSidebar();
          });
        });
        const rmBtn = row.querySelector('[data-remove]');
        if (rmBtn) rmBtn.addEventListener('click', () => {
          state.agents.splice(idx, 1);
          renderAgents();
          updateSidebar();
        });
      });
    }

    function escHtml(s) {
      return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
    }

    $('add-agent-btn').addEventListener('click', () => {
      const emojis = ['ðŸ¤–','ðŸ”','âœï¸','ðŸŽ¨','ðŸ›¡ï¸','ðŸ“¡','âš™ï¸','ðŸ§ª','ðŸ“Š','ðŸŽ¯'];
      state.agents.push({
        emoji: emojis[state.agents.length % emojis.length],
        name: '',
        desc: ''
      });
      renderAgents();
      updateSidebar();
    });

    // â”€â”€ Skills â”€â”€
    $$('.skill-card').forEach(card => {
      card.addEventListener('click', () => {
        const skill = card.dataset.skill;
        if (state.skills.has(skill)) {
          state.skills.delete(skill);
          card.classList.remove('enabled');
        } else {
          state.skills.add(skill);
          card.classList.add('enabled');
        }
        updateSidebar();
      });
    });

    // â”€â”€ System prompt â”€â”€
    $('system-prompt').addEventListener('input', e => {
      state.systemPrompt = e.target.value;
      saveDraft();
    });

    // â”€â”€ File editor â”€â”€
    const fileTabs = $$('#file-tabs .file-tab');
    fileTabs.forEach(tab => {
      tab.addEventListener('click', () => {
        // Save current
        state.files[state.activeFile] = $('file-editor').value;
        // Switch
        fileTabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        state.activeFile = tab.dataset.file;
        $('file-editor').value = state.files[state.activeFile] || '';
      });
    });

    // Auto-save file editor
    $('file-editor').addEventListener('input', () => {
      state.files[state.activeFile] = $('file-editor').value;
      saveDraft();
    });

    // â”€â”€ Model â”€â”€
    $$('.model-card').forEach(card => {
      card.addEventListener('click', () => {
        $$('.model-card').forEach(c => c.classList.remove('selected'));
        card.classList.add('selected');
        state.model = card.dataset.model;
        updateSidebar();
      });
    });

    // â”€â”€ Load flavours as templates â”€â”€
    async function loadFlavours() {
      try {
        const resp = await fetch('/flavours.json');
        allFlavours = await resp.json();
        const sel = $('template-select');
        allFlavours.forEach(f => {
          const opt = document.createElement('option');
          opt.value = f.id;
          opt.textContent = `${f.emoji} ${f.name}`;
          sel.appendChild(opt);
        });
      } catch {}
    }

    $('template-select').addEventListener('change', () => {
      const id = $('template-select').value;
      if (!id) {
        // Reset to blank
        state.emoji = 'ðŸ¦€';
        state.name = 'My Server';
        state.runtime = 'single';
        state.agents = [{ emoji: 'ðŸ¦€', name: 'Claw', desc: 'General-purpose coding assistant' }];
        state.skills = new Set(['chat', 'filesystem', 'execute']);
        state.model = 'upstage/solar-pro-3:free';
        $('system-prompt').value = 'You are ðŸ¦€ Claw, a helpful coding assistant. Be concise, direct, and pragmatic.';
        state.systemPrompt = $('system-prompt').value;
      } else {
        const fl = allFlavours.find(f => f.id === id);
        if (!fl) return;
        state.emoji = fl.emoji;
        state.name = fl.name;
        state.runtime = (fl.teams && fl.teams.length > 0) ? 'multi' : 'single';
        state.agents = fl.agents.map(a => ({ emoji: a.emoji, name: a.name, desc: a.description }));
        state.skills = new Set((fl.skills || []).map(s => s.name));
        // Also enable the built-in skills
        ['chat', 'filesystem', 'execute'].forEach(s => state.skills.add(s));
        state.systemPrompt = fl.systemPrompt || '';
        $('system-prompt').value = state.systemPrompt;
      }

      // Update UI
      $('server-emoji').value = state.emoji;
      $('server-name').value = state.name;
      $$('#runtime-options .option-card').forEach(c => {
        c.classList.toggle('selected', c.dataset.value === state.runtime);
      });
      renderAgents();
      $$('.skill-card').forEach(card => {
        card.classList.toggle('enabled', state.skills.has(card.dataset.skill));
      });
      updateSidebar();
    });

    // â”€â”€ Build spec â”€â”€
    function buildSpec() {
      state.files[state.activeFile] = $('file-editor').value;
      state.systemPrompt = $('system-prompt').value;
      return {
        specVersion: '1.0',
        id: 'srv_' + Math.random().toString(36).slice(2, 10),
        name: state.name,
        emoji: state.emoji,
        runtime: { type: state.runtime, model: { provider: 'openrouter', model: state.model } },
        agents: state.agents.map((a, i) => ({
          id: i === 0 ? 'main' : a.name.toLowerCase().replace(/[^a-z0-9]/g, '') || 'agent' + i,
          name: a.name,
          emoji: a.emoji,
          role: i === 0 ? 'lead' : 'specialist',
          description: a.desc,
          ...(i === 0 ? { systemPrompt: state.systemPrompt } : {})
        })),
        skills: [...state.skills].map(s => ({ source: 'builtin:' + s })),
        workspace: { ...state.files },
      };
    }

    // â”€â”€ Inline Preview Chat â”€â”€
    let previewMessages = [];
    let previewGenerating = false;
    let previewAbortController = null;
    let previewPinned = false;

    // â”€â”€ Markdown renderer for preview â”€â”€
    function renderMd(text) {
      let h = escHtml(text);
      // Code blocks with language tag + copy button
      h = h.replace(/```(\w*)\n([\s\S]*?)```/g, (_, lang, code) => {
        const langTag = lang ? `<span class="preview-code-lang">${lang}</span>` : '';
        return `<pre>${langTag}<code>${code.trim()}</code></pre>`;
      });
      // Inline code
      h = h.replace(/`([^`]+)`/g, '<code>$1</code>');
      // Headers
      h = h.replace(/^### (.+)$/gm, '<h3>$1</h3>');
      h = h.replace(/^## (.+)$/gm, '<h2>$1</h2>');
      h = h.replace(/^# (.+)$/gm, '<h1>$1</h1>');
      // Bold + italic
      h = h.replace(/\*\*\*(.+?)\*\*\*/g, '<strong><em>$1</em></strong>');
      h = h.replace(/\*\*(.+?)\*\*/g, '<strong style="color:var(--text-bright);">$1</strong>');
      h = h.replace(/\*(.+?)\*/g, '<em>$1</em>');
      // Blockquotes
      h = h.replace(/^&gt; (.+)$/gm, '<blockquote>$1</blockquote>');
      // Unordered lists
      h = h.replace(/^[\-\*] (.+)$/gm, '<li>$1</li>');
      h = h.replace(/(<li>.*<\/li>\n?)+/g, '<ul>$&</ul>');
      // Ordered lists
      h = h.replace(/^\d+\. (.+)$/gm, '<li>$1</li>');
      // Links
      h = h.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" style="color:var(--accent);">$1</a>');
      // Line breaks (but not inside blocks)
      h = h.replace(/\n/g, '<br>');
      // Clean up excess breaks around block elements
      h = h.replace(/<br>\s*(<\/?(?:pre|ul|ol|li|h[1-3]|blockquote))/g, '$1');
      h = h.replace(/(<\/(?:pre|ul|ol|li|h[1-3]|blockquote)>)\s*<br>/g, '$1');
      return h;
    }

    function renderPreviewMessages() {
      const container = $('preview-messages');
      const empty = container.querySelector('.preview-empty');

      if (previewMessages.length === 0 && !previewGenerating) {
        if (empty) empty.style.display = '';
        container.querySelectorAll('.preview-msg').forEach(el => el.remove());
        return;
      }

      if (empty) empty.style.display = 'none';

      let html = '';
      for (const msg of previewMessages) {
        const isUser = msg.role === 'user';
        const cls = isUser ? 'user' : 'assistant';
        const emoji = isUser ? 'ðŸ‘¤' : (state.emoji || 'ðŸ¤–');
        const rendered = isUser ? escHtml(msg.content) : renderMd(msg.content);
        html += `<div class="preview-msg ${cls}">
          <div class="preview-msg-avatar">${emoji}</div>
          <div class="preview-msg-bubble">${rendered}</div>
        </div>`;
      }

      if (previewGenerating) {
        html += `<div class="preview-msg assistant">
          <div class="preview-msg-avatar">${state.emoji || 'ðŸ¤–'}</div>
          <div class="preview-msg-bubble"><div class="preview-loading"><span></span><span></span><span></span></div></div>
        </div>`;
      }

      container.querySelectorAll('.preview-msg').forEach(el => el.remove());
      container.insertAdjacentHTML('beforeend', html);
      container.scrollTop = container.scrollHeight;
    }

    async function sendPreviewMessage() {
      const input = $('preview-input');
      const text = input.value.trim();
      if (!text || previewGenerating) return;

      input.value = '';
      input.style.height = 'auto';

      const userMsg = { role: 'user', content: text };
      previewMessages.push(userMsg);
      previewGenerating = true;
      renderPreviewMessages();

      if (previewAbortController) previewAbortController.abort();
      previewAbortController = new AbortController();

      try {
        const spec = buildSpec();
        const sysPrompt = spec.agents[0]?.systemPrompt || 'You are a helpful assistant.';
        const chatMessages = [
          { role: 'system', content: sysPrompt },
          ...previewMessages.filter(m => m.role !== 'system').map(m => ({ role: m.role, content: m.content })),
        ];

        const resp = await fetch('/api/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            model: spec.runtime?.model?.model || 'upstage/solar-pro-3:free',
            messages: chatMessages,
            max_tokens: 2048,
          }),
          signal: previewAbortController.signal,
        });

        if (!resp.ok) {
          let errMsg = `Error ${resp.status}`;
          try { const e = await resp.json(); errMsg = e.error?.message || e.message || errMsg; } catch {}
          throw new Error(errMsg);
        }

        const data = await resp.json();
        const content = data.choices?.[0]?.message?.content || 'No response';

        previewMessages.push({ role: 'assistant', content });
      } catch (err) {
        if (err.name === 'AbortError') return;
        previewMessages.push({ role: 'assistant', content: `âš ï¸ ${err.message}` });
      } finally {
        previewGenerating = false;
        previewAbortController = null;
        renderPreviewMessages();
      }
    }

    function openPreview() {
      const panel = $('preview-chat');
      const spec = buildSpec();
      $('preview-title-text').textContent = `${spec.emoji || 'ðŸ¤–'} ${spec.name || 'Preview'}`;
      panel.classList.add('active');
      panel.classList.remove('collapsed');
      $('preview-retrieve').classList.remove('visible');
      if (previewMessages.length === 0) renderPreviewMessages();
      setTimeout(() => $('preview-input').focus(), 150);
    }

    function closePreview() {
      $('preview-chat').classList.remove('active', 'collapsed');
      $('preview-retrieve').classList.remove('visible');
      previewPinned = false;
      $('preview-pin').classList.remove('active');
    }

    function collapsePreview() {
      $('preview-chat').classList.add('collapsed');
      $('preview-retrieve').classList.add('visible');
    }

    $('preview-btn').addEventListener('click', () => {
      const panel = $('preview-chat');
      const isOpen = panel.classList.contains('active') && !panel.classList.contains('collapsed');
      if (isOpen) {
        closePreview();
      } else {
        openPreview();
      }
    });

    // Pin â€” keeps panel open when clicking outside
    $('preview-pin').addEventListener('click', () => {
      previewPinned = !previewPinned;
      $('preview-pin').classList.toggle('active', previewPinned);
    });

    // Collapse â€” slide off-screen, show retrieve tab
    $('preview-collapse').addEventListener('click', collapsePreview);

    // Retrieve â€” bring back from collapsed
    $('preview-retrieve').addEventListener('click', () => {
      const panel = $('preview-chat');
      panel.classList.remove('collapsed');
      $('preview-retrieve').classList.remove('visible');
      setTimeout(() => $('preview-input').focus(), 150);
    });

    // Clear chat
    $('preview-clear').addEventListener('click', () => {
      previewMessages = [];
      renderPreviewMessages();
    });

    // Close
    $('preview-close').addEventListener('click', closePreview);

    $('preview-send').addEventListener('click', sendPreviewMessage);

    $('preview-input').addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendPreviewMessage();
      }
    });

    // Auto-resize preview input
    $('preview-input').addEventListener('input', function() {
      this.style.height = 'auto';
      this.style.height = Math.min(this.scrollHeight, 100) + 'px';
    });

    // â”€â”€ Save to library â”€â”€
    $('save-btn').addEventListener('click', () => {
      // Force immediate save â€” bypass debounce
      clearTimeout(_draftTimer);
      state.files[state.activeFile] = $('file-editor').value;
      state.systemPrompt = $('system-prompt').value;
      const draft = {
        emoji: state.emoji, name: state.name, runtime: state.runtime,
        agents: state.agents, skills: [...state.skills],
        systemPrompt: state.systemPrompt, files: state.files,
        activeFile: state.activeFile, model: state.model, savedAt: Date.now()
      };
      localStorage.setItem(DRAFT_KEY, JSON.stringify(draft));
      const ds = $('draft-status');
      if (ds) { ds.textContent = 'Saved'; ds.style.opacity = '1'; ds.style.color = 'var(--green)';
        clearTimeout(ds._fadeTimer); ds._fadeTimer = setTimeout(() => { ds.style.opacity = '0'; ds.style.color = 'var(--text-dim)'; }, 2000); }
    });

    // â”€â”€ Deploy modal â”€â”€
    const deployModal = $('deploy-modal');
    const deployCommandArea = $('deploy-command-area');
    const deployCommandLabel = $('deploy-command-label');
    const deployCommandText = $('deploy-command-text');
    let deploySpec = null;

    function showDeployModal() {
      deploySpec = buildSpec();
      deployModal.style.display = '';
      deployCommandArea.style.display = 'none';
    }

    function hideDeployModal() {
      deployModal.style.display = 'none';
    }

    function showCommand(label, cmd) {
      deployCommandLabel.textContent = label;
      deployCommandText.textContent = cmd;
      deployCommandArea.style.display = '';
    }

    function downloadBlob(content, filename, type) {
      const blob = new Blob([content], { type });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      a.click();
      URL.revokeObjectURL(url);
    }

    function specToSlug(spec) {
      return (spec.name || 'server').toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-|-$/g, '');
    }

    function generateOpenClawConfig(spec) {
      const model = spec.runtime?.model?.model || 'anthropic/claude-sonnet-4';
      // Map OpenRouter model IDs to OpenClaw provider/model format
      const provider = model.includes('/') ? model.split('/')[0] : 'anthropic';
      const modelId = model.includes('/') ? model : `anthropic/${model}`;

      const config = {
        agents: {
          defaults: {
            model: { primary: modelId },
            workspace: './workspace',
          },
        },
        sessions: {
          defaults: {
            model: modelId,
          },
        },
      };
      return JSON.stringify(config, null, 2);
    }

    function generateSetupScript(spec) {
      const slug = specToSlug(spec);
      return `#!/bin/bash
# ${spec.name} â€” Setup Script
# Generated by VibeClaw (vibeclaw.dev)
set -e

echo "Setting up ${spec.name}..."

# Install OpenClaw if not present
if ! command -v openclaw &> /dev/null; then
  echo "Installing OpenClaw..."
  curl -fsSL https://openclaw.ai/install.sh | bash -s -- --no-onboard
fi

# Create workspace directory
mkdir -p workspace

# Copy config
cp openclaw.json ~/.openclaw/openclaw.json

# Copy workspace files
for f in workspace/*; do
  [ -f "$f" ] && cp "$f" ~/.openclaw/workspace/
done

echo ""
echo "Done! Run: openclaw gateway start"
echo ""
`;
    }

    function generateReadme(spec) {
      const agentList = (spec.agents || []).map(a => `- **${a.name}** â€” ${a.description || a.role || ''}`).join('\n');
      const skillList = (spec.skills || []).map(s => `- ${(s.source || s.name || '').replace('builtin:', '')}`).join('\n');
      return `# ${spec.name}

> Generated by [VibeClaw](https://vibeclaw.dev/forge)

## Agents

${agentList}

## Skills

${skillList}

## Setup

\`\`\`bash
# Option 1: Run the setup script
chmod +x setup.sh && ./setup.sh

# Option 2: Manual
curl -fsSL https://openclaw.ai/install.sh | bash
cp openclaw.json ~/.openclaw/openclaw.json
cp workspace/* ~/.openclaw/workspace/
openclaw gateway start
\`\`\`
`;
    }

    $('deploy-btn').addEventListener('click', showDeployModal);
    $('deploy-close').addEventListener('click', hideDeployModal);
    deployModal.addEventListener('click', (e) => {
      if (e.target === deployModal) hideDeployModal();
    });

    // Download package â€” real openclaw.json + workspace files + setup script
    $('deploy-download').addEventListener('click', () => {
      if (!deploySpec) return;
      const slug = specToSlug(deploySpec);

      // Build all files
      const files = {
        'openclaw.json': generateOpenClawConfig(deploySpec),
        'setup.sh': generateSetupScript(deploySpec),
        'README.md': generateReadme(deploySpec),
      };
      // Add workspace files
      const ws = deploySpec.workspace || {};
      for (const [name, content] of Object.entries(ws)) {
        if (content) files[`workspace/${name}`] = content;
      }
      // Add server spec for reference
      files['server-spec.json'] = JSON.stringify(deploySpec, null, 2);

      // Download as a single JSON manifest (with clear file paths)
      // Users can extract with a simple script, or we can add zip later
      const pkg = { _generator: 'VibeClaw v1.0', _url: 'https://vibeclaw.dev', files };
      downloadBlob(JSON.stringify(pkg, null, 2), `${slug}.vibeclaw.json`, 'application/json');
      hideDeployModal();
    });

    // Raw JSON spec
    $('deploy-json').addEventListener('click', () => {
      if (!deploySpec) return;
      downloadBlob(JSON.stringify(deploySpec, null, 2), `${specToSlug(deploySpec)}-spec.json`, 'application/json');
      hideDeployModal();
    });

    // Docker command â€” not available yet, show install instructions instead
    $('deploy-docker').addEventListener('click', () => {
      if (!deploySpec) return;
      showCommand('Install & Run', `curl -fsSL https://openclaw.ai/install.sh | bash && openclaw gateway start`);
    });

    // CLI command â€” real openclaw install
    $('deploy-cli').addEventListener('click', () => {
      if (!deploySpec) return;
      showCommand('Install OpenClaw', `npm install -g openclaw && openclaw onboard`);
    });

    // Copy command
    $('deploy-copy-btn').addEventListener('click', () => {
      const text = deployCommandText.textContent;
      navigator.clipboard.writeText(text).then(() => {
        $('deploy-copy-btn').innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="var(--green)" stroke-width="2" style="width:14px;height:14px;"><polyline points="20 6 9 17 4 12"/></svg>';
        setTimeout(() => {
          $('deploy-copy-btn').innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="width:14px;height:14px;"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>';
        }, 1500);
      });
    });

    // â”€â”€ Init â”€â”€
    state.systemPrompt = $('system-prompt').value;

    // Check if loaded with a template ID or library index
    const params = new URLSearchParams(location.search);
    if (params.has('template')) {
      loadFlavours().then(() => {
        $('template-select').value = params.get('template');
        $('template-select').dispatchEvent(new Event('change'));
      });
    } else if (params.has('load')) {
      // Load from library
      try {
        const library = JSON.parse(localStorage.getItem('clawforge-library') || '[]');
        const idx = parseInt(params.get('load'));
        const srv = library[idx];
        if (srv) {
          state.emoji = srv.emoji || 'ðŸ¦€';
          state.name = srv.name || 'My Server';
          state.runtime = srv.runtime?.type || 'single';
          state.agents = (srv.agents || []).map(a => ({
            emoji: a.emoji || 'ðŸ¤–',
            name: a.name || '',
            desc: a.description || a.role || ''
          }));
          state.skills = new Set((srv.skills || []).map(s =>
            s.source ? s.source.replace('builtin:', '') : s.name || ''
          ).filter(Boolean));
          state.systemPrompt = (srv.agents && srv.agents[0] && srv.agents[0].systemPrompt) || '';
          if (srv.workspace) {
            Object.assign(state.files, srv.workspace);
          }
          state.model = srv.runtime?.model?.model || state.model;

          // Update all UI
          $('server-emoji').value = state.emoji;
          $('server-name').value = state.name;
          $('system-prompt').value = state.systemPrompt;
          $('file-editor').value = state.files[state.activeFile] || '';
          $$('#runtime-options .option-card').forEach(c => {
            c.classList.toggle('selected', c.dataset.value === state.runtime);
          });
          $$('.skill-card').forEach(card => {
            card.classList.toggle('enabled', state.skills.has(card.dataset.skill));
          });
          $$('.model-card').forEach(c => {
            c.classList.toggle('selected', c.dataset.model === state.model);
          });
          renderAgents();
          updateSidebar();
        }
      } catch (e) { console.warn('Load from library error:', e); }
    } else {
      // Check for a saved draft
      try {
        const draftRaw = localStorage.getItem(DRAFT_KEY);
        if (draftRaw) {
          const draft = JSON.parse(draftRaw);
          // Only restore if draft is less than 7 days old
          if (draft.savedAt && (Date.now() - draft.savedAt) < 7 * 24 * 60 * 60 * 1000) {
            state.emoji = draft.emoji || state.emoji;
            state.name = draft.name || state.name;
            state.runtime = draft.runtime || state.runtime;
            state.agents = draft.agents || state.agents;
            state.skills = new Set(draft.skills || [...state.skills]);
            state.systemPrompt = draft.systemPrompt || state.systemPrompt;
            if (draft.files) Object.assign(state.files, draft.files);
            state.model = draft.model || state.model;

            // Update UI
            $('server-emoji').value = state.emoji;
            $('server-name').value = state.name;
            $('system-prompt').value = state.systemPrompt;
            $('file-editor').value = state.files[state.activeFile] || '';
            $$('#runtime-options .option-card').forEach(c => {
              c.classList.toggle('selected', c.dataset.value === state.runtime);
            });
            $$('.skill-card').forEach(card => {
              card.classList.toggle('enabled', state.skills.has(card.dataset.skill));
            });
            $$('.model-card').forEach(c => {
              c.classList.toggle('selected', c.dataset.model === state.model);
            });
            renderAgents();
            updateSidebar();
          }
        }
      } catch (e) { console.warn('Draft restore error:', e); }
      loadFlavours();
    }
  </script>

  <script src="/auth.js"></script>
    <script src="/features.js"></script>
  <script>
    VibeclawAuth.init().then(() => {
      VibeclawAuth.renderButton('auth-container');
      VibeclawFeatures.renderUpgradeButton('upgrade-container');
      VibeclawFeatures.checkPro();
    });
    // Show Pro models in preview mode
    if (VibeclawFeatures && VibeclawFeatures.isPreview()) {
      document.querySelectorAll('.pro-model').forEach(el => el.style.display = '');
    }
  </script>

</body>
</html>
